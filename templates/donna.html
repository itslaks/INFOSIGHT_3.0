<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DONNA AI - Ultimate Dark Web OSINT Platform</title>
    <link rel="icon" type="image/png" href="/static/images/donna_ai.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --charcoal: #1a1a1a;
            --dark-charcoal: #0f0f0f;
            --light-charcoal: #2a2a2a;
            --orange: #ff6b35;
            --orange-dark: #d45428;
            --orange-light: #ff8c5a;
            --text-primary: #e5e5e5;
            --text-secondary: #a0a0a0;
            --success: #4ade80;
            --warning: #fbbf24;
            --error: #ef4444;
            --critical: #dc2626;
            --info: #3b82f6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--dark-charcoal);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.03;
            background: 
                radial-gradient(circle at 20% 50%, var(--orange) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, var(--orange-light) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, var(--orange-dark) 0%, transparent 50%);
            animation: bgMove 20s ease infinite;
        }

        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-20px, -20px) scale(1.1); }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--charcoal) 0%, var(--light-charcoal) 100%);
            padding: 1.2rem 2rem;
            border-bottom: 2px solid rgba(255, 107, 53, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.7);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 55px;
            height: 55px;
            background: var(--charcoal);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--orange);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
            animation: logoPulse 3s ease-in-out infinite;
        }

        .logo-icon img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 53, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 107, 53, 0.6); }
        }

        .logo-text h1 {
            font-size: 1.9rem;
            background: linear-gradient(120deg, var(--orange) 0%, var(--orange-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .logo-text p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.2rem;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .model-selector {
            position: relative;
        }

        .model-selector-btn {
            padding: 0.75rem 1.5rem;
            background: var(--light-charcoal);
            border: 2px solid var(--orange);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .model-selector-btn:hover {
            background: var(--orange);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }

        .model-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: var(--light-charcoal);
            border: 2px solid var(--orange);
            border-radius: 10px;
            padding: 0.5rem;
            min-width: 280px;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 100;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .model-dropdown.active {
            display: block;
        }

        .model-option {
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
        }

        .model-option:hover {
            background: var(--charcoal);
            border-color: var(--orange);
        }

        .model-option.selected {
            background: rgba(255, 107, 53, 0.1);
            border-color: var(--orange);
        }

        .model-option-title {
            font-weight: 600;
            color: var(--orange);
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .model-option-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .status-indicators {
            display: flex;
            gap: 1rem;
        }

        .status-badge {
            padding: 0.6rem 1.2rem;
            background: var(--light-charcoal);
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid var(--charcoal);
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--success);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.8); }
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Alert System */
        .alert-container {
            position: fixed;
            top: 5rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 400px;
        }

        .alert {
            padding: 1.2rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            animation: slideInRight 0.4s ease;
            border-left: 4px solid;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert.success {
            background: rgba(74, 222, 128, 0.15);
            border-color: var(--success);
            color: var(--success);
        }

        .alert.error {
            background: rgba(239, 68, 68, 0.15);
            border-color: var(--error);
            color: var(--error);
        }

        .alert.info {
            background: rgba(59, 130, 246, 0.15);
            border-color: var(--info);
            color: var(--info);
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-close {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .alert-close:hover {
            opacity: 1;
        }

        /* Search Section */
        .search-section {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.2);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .search-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.05) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .search-content {
            position: relative;
            z-index: 1;
        }

        .search-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .search-header h2 {
            font-size: 2.2rem;
            margin-bottom: 0.8rem;
            background: linear-gradient(120deg, var(--orange) 0%, var(--orange-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }

        .search-header p {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .main-input-group {
            display: flex;
            gap: 1rem;
            align-items: stretch;
        }

        .search-input-wrapper {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1.3rem 1.5rem 1.3rem 3.5rem;
            background: var(--charcoal);
            border: 2px solid var(--light-charcoal);
            border-radius: 15px;
            color: var(--text-primary);
            font-size: 1.05rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.3rem;
            color: var(--orange);
        }

        .search-button {
            padding: 1.3rem 3rem;
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-dark) 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
            position: relative;
            overflow: hidden;
        }

        .search-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .search-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .search-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 107, 53, 0.5);
        }

        .search-button:active {
            transform: translateY(-1px);
        }

        .search-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .search-button span {
            position: relative;
            z-index: 1;
        }

        
        .detailed-stats {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 107, 53, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .detailed-stats h4 {
            color: var(--orange);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .stats-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .breakdown-item {
            padding: 1rem;
            background: var(--charcoal);
            border-radius: 10px;
            border-left: 3px solid var(--orange);
        }

        .breakdown-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 0.3rem;
        }

        .breakdown-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--orange);
        }

        .advanced-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            background: rgba(15, 15, 15, 0.5);
            border-radius: 15px;
            border: 1px solid var(--charcoal);
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
        }

        .option-group label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .option-select, .option-input {
            padding: 0.9rem 1.2rem;
            background: var(--charcoal);
            border: 2px solid var(--light-charcoal);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .option-select:focus, .option-input:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        /* Loading Section */
        .loading-section {
            display: none;
            padding: 3rem;
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .loading-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-content {
            text-align: center;
        }

        .spinner-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 2rem;
        }

        .spinner {
            width: 100%;
            height: 100%;
            border: 4px solid var(--charcoal);
            border-top: 4px solid var(--orange);
            border-right: 4px solid var(--orange-light);
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        .spinner-inner {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            border: 4px solid transparent;
            border-bottom: 4px solid var(--orange);
            border-left: 4px solid var(--orange-dark);
            border-radius: 50%;
            animation: spin 1.8s linear infinite reverse;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.4rem;
            color: var(--orange);
            margin-bottom: 0.8rem;
            font-weight: 700;
        }

        .loading-subtext {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .loading-progress {
            font-size: 2rem;
            color: var(--orange);
            font-weight: 800;
            margin-top: 1rem;
        }

        .progress-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2.5rem;
        }

        .progress-step {
            padding: 1rem;
            background: var(--charcoal);
            border-radius: 12px;
            font-size: 0.9rem;
            border: 2px solid transparent;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .progress-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.3), transparent);
            transition: left 0.5s;
        }

        .progress-step.active {
            border-color: var(--orange);
            background: rgba(255, 107, 53, 0.1);
            transform: scale(1.05);
        }

        .progress-step.active::before {
            left: 100%;
        }

        .progress-step.completed {
            background: rgba(74, 222, 128, 0.1);
            border-color: var(--success);
        }

        .step-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* Results Section */
        .results-section {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 107, 53, 0.2);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .comparison-panel {
            background: var(--charcoal);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 2px solid var(--light-charcoal);
            display: none;
        }

        .comparison-panel.active {
            display: block;
            animation: slideDown 0.4s ease;
        }

        .investigation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .investigation-info h3 {
            color: var(--orange);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 800;
        }

        .investigation-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Courier New', monospace;
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 0.9rem 1.8rem;
            background: var(--charcoal);
            border: 2px solid var(--orange);
            color: var(--orange);
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .export-btn:hover {
            background: var(--orange);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .query-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(15, 15, 15, 0.5);
            border-radius: 12px;
            border: 1px solid var(--charcoal);
        }

        .query-detail {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .query-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 600;
        }

        .query-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2rem;
            border-radius: 16px;
            border: 2px solid var(--light-charcoal);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.1), transparent);
            transition: left 0.6s;
        }

        .stat-card:hover {
            border-color: var(--orange);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px rgba(255, 107, 53, 0.5));
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(120deg, var(--orange) 0%, var(--orange-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

       .stat-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .detailed-stats {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 107, 53, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .detailed-stats h4 {
            color: var(--orange);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .stats-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .breakdown-item {
            padding: 1rem;
            background: var(--charcoal);
            border-radius: 10px;
            border-left: 3px solid var(--orange);
        }

        .breakdown-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 0.3rem;
        }

        .breakdown-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--orange);
        }

        /* Threat Analysis */
        .threat-analysis {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            border-left: 5px solid var(--orange);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .threat-analysis h3 {
            color: var(--orange);
            font-size: 1.8rem;
            margin-bottom: 2rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .threat-level-container {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 2rem;
            background: rgba(15, 15, 15, 0.5);
            border-radius: 15px;
            flex-wrap: wrap;
        }

        .threat-badge {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: badgePulse 2s ease-in-out infinite;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .threat-badge.critical {
            background: linear-gradient(135deg, var(--critical) 0%, #991b1b 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.5);
        }

        .threat-badge.high {
            background: linear-gradient(135deg, var(--error) 0%, #b91c1c 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.5);
        }

        .threat-badge.medium {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: var(--dark-charcoal);
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.5);
        }

        .threat-badge.low {
            background: linear-gradient(135deg, var(--success) 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(74, 222, 128, 0.5);
        }

        .threat-score-container {
            flex: 1;
            min-width: 300px;
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .score-bar {
            height: 16px;
            background: var(--charcoal);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--orange) 0%, var(--orange-light) 50%, var(--orange) 100%);
            background-size: 200% 100%;
            transition: width 2s ease;
            animation: shimmer 3s linear infinite;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.6);
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .threat-description {
            padding: 1.5rem;
            background: rgba(15, 15, 15, 0.5);
            border-radius: 12px;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            border-left: 3px solid var(--orange);
        }

        .threat-sections {
            display: grid;
            gap: 1.5rem;
        }

        .threat-section-card {
            padding: 1.5rem;
            background: rgba(15, 15, 15, 0.5);
            border-radius: 12px;
            border: 1px solid var(--charcoal);
        }

        .threat-section-title {
            color: var(--orange);
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .indicator-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .indicator-item {
            padding: 1rem;
            background: var(--charcoal);
            border-radius: 10px;
            border-left: 3px solid var(--orange);
            transition: all 0.3s ease;
            display: flex;
            align-items: start;
            gap: 0.8rem;
        }

        .indicator-item:hover {
            transform: translateX(5px);
            border-left-width: 5px;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
        }

        .indicator-number {
            background: var(--orange);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .indicator-text {
            flex: 1;
            line-height: 1.6;
        }

        /* Artifacts Section */
        .artifacts-section {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .artifacts-section h3 {
            color: var(--orange);
            margin-bottom: 1rem;
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .artifacts-summary {
            padding: 1.5rem;
            background: rgba(15, 15, 15, 0.5);
            border-radius: 12px;
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: space-around;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--orange);
            margin-bottom: 0.3rem;
        }

        .summary-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 600;
        }

        
        .artifact-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.6rem 1.2rem;
            background: var(--charcoal);
            border: 2px solid var(--light-charcoal);
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .filter-btn:hover, .filter-btn.active {
            border-color: var(--orange);
            color: var(--orange);
            background: rgba(255, 107, 53, 0.1);
        }

        .artifacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .artifact-category {
            background: var(--charcoal);
            padding: 1.8rem;
            border-radius: 15px;
            border: 2px solid var(--light-charcoal);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .artifact-category::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.05), transparent);
            transition: left 0.6s;
        }

        .artifact-category:hover {
            border-color: var(--orange);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.2);
        }

        .artifact-category:hover::before {
            left: 100%;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-charcoal);
        }

        .category-title {
            font-size: 1.15rem;
            color: var(--orange);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-count {
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-dark) 100%);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 800;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.3);
        }

        .artifact-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .artifact-item {
            padding: 0.9rem;
            background: var(--dark-charcoal);
            border-radius: 8px;
            margin-bottom: 0.8rem;
            font-family: 'Courier New', monospace;
            font-size: 0.88rem;
            word-break: break-all;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .artifact-item:hover {
            background: rgba(255, 107, 53, 0.05);
            border-color: var(--orange);
            transform: translateX(3px);
        }

        .artifact-value {
            flex: 1;
            margin-right: 0.8rem;
        }

        .confidence-badge {
            background: var(--success);
            color: white;
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(74, 222, 128, 0.3);
        }

        .no-artifacts {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Sources Section */
        .sources-section {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .sources-section h3 {
            color: var(--orange);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .sources-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .source-item {
            padding: 1.2rem;
            background: var(--charcoal);
            border-radius: 12px;
            border: 2px solid var(--light-charcoal);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .source-item:hover {
            border-color: var(--orange);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
        }

        .source-url {
            color: var(--orange);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            word-break: break-all;
        }

        .source-type {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: var(--orange);
            color: white;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* Report Section */
        .report-section {
            background: linear-gradient(135deg, var(--light-charcoal) 0%, var(--charcoal) 100%);
            padding: 2.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .report-section h3 {
            color: var(--orange);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .report-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .report-action-btn {
            padding: 0.7rem 1.5rem;
            background: var(--charcoal);
            border: 2px solid var(--orange);
            color: var(--orange);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .report-action-btn:hover {
            background: var(--orange);
            color: white;
        }

        .report-content {
            background: var(--charcoal);
            padding: 2.5rem;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.92rem;
            line-height: 1.9;
            white-space: pre-wrap;
            max-height: 700px;
            overflow-y: auto;
            border: 2px solid var(--light-charcoal);
            color: var(--text-primary);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--charcoal);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-dark) 100%);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--orange-light) 0%, var(--orange) 100%);
        }

        /* Print Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            
            .header, .search-section, .loading-section,
            .export-buttons, .report-actions {
                display: none !important;
            }
            
            .results-section {
                display: block !important;
            }
            
            .stat-card, .artifact-category, .source-item {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            .results-header {
                page-break-after: avoid;
            }
            
            .threat-analysis, .artifacts-section, .sources-section {
                page-break-before: auto;
                page-break-inside: avoid;
            }
            
            /* Add watermark */
            @page {
                margin: 1.5cm;
                
                @bottom-center {
                    content: "DONNA AI - Confidential OSINT Report";
                    font-size: 8pt;
                    color: #999;
                }
                
                @top-right {
                    content: "Page " counter(page);
                    font-size: 8pt;
                }
            }
            
            body::before {
                content: "DONNA AI CONFIDENTIAL";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-45deg);
                font-size: 120pt;
                color: rgba(0, 0, 0, 0.05);
                z-index: -1;
                font-weight: bold;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .header-actions {
                flex-direction: column;
                width: 100%;
            }

            .model-selector-btn {
                width: 100%;
                justify-content: center;
            }

            .main-input-group {
                flex-direction: column;
            }

            .search-button {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .artifacts-grid {
                grid-template-columns: 1fr;
            }

            .progress-steps {
                grid-template-columns: 1fr;
            }

            .threat-level-container {
                flex-direction: column;
            }

            .investigation-header {
                flex-direction: column;
            }

            .export-buttons {
                width: 100%;
            }

            .export-btn {
                flex: 1;
                justify-content: center;
            }

            .alert-container {
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }

        /* Utility Classes */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-up {
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Copy to Clipboard Animation */
        .copied-feedback {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            opacity: 0;
            transform: translateY(20px);
            animation: copyFeedback 2s ease;
            z-index: 3000;
        }

        @keyframes copyFeedback {
            0% { opacity: 0; transform: translateY(20px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="/static/images/donna_ai.png" alt="DONNA AI">
                </div>
                <div class="logo-text">
                    <h1>DONNA AI</h1>
                    <p>Ultimate Dark Web OSINT Intelligence Platform v3.0</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="model-selector">
                    <button class="model-selector-btn" id="modelSelectorBtn">
                        <span>ü§ñ</span>
                        <span id="currentModel">Ollama (Local)</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="model-dropdown" id="modelDropdown">
                        <div class="model-option selected" data-model="ollama">
                            <div class="model-option-title">üñ•Ô∏è Ollama (Local)</div>
                            <div class="model-option-desc">LLaMA 3.2 - Fast, private, local processing</div>
                        </div>
                        <div class="model-option" data-model="gemini">
                            <div class="model-option-title">‚òÅÔ∏è Google Gemini (Cloud)</div>
                            <div class="model-option-desc">Advanced AI - Enhanced analysis capabilities</div>
                        </div>
                    </div>
                </div>
                <div class="status-indicators">
                    <div class="status-badge">
                        <div class="status-dot"></div>
                        <span id="systemStatus">System Online</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Search Section -->
        <div class="search-section">
            <div class="search-content">
                <div class="search-header">
                    <h2>üîç Intelligence Investigation</h2>
                    <p>Enter your query to begin comprehensive dark web OSINT analysis with advanced threat detection</p>
                </div>
                <form id="searchForm" class="search-form">
                    <div class="main-input-group">
                        <div class="search-input-wrapper">
                            <span class="search-icon">üîé</span>
                            <input 
                                type="text" 
                                id="searchQuery" 
                                class="search-input" 
                                placeholder="e.g., cryptocurrency fraud, ransomware groups, data breach..."
                                required
                            >
                        </div>
                        <button type="submit" class="search-button" id="searchBtn">
                            <span>üöÄ Start Investigation</span>
                        </button>
                    </div>
                    <div class="advanced-options">
                        <div class="option-group">
                            <label>‚ö° Thread Count</label>
                            <select id="threadCount" class="option-select">
                                <option value="6">6 Threads - Fast</option>
                                <option value="8" selected>8 Threads - Balanced</option>
                                <option value="10">10 Threads - Aggressive</option>
                                <option value="12">12 Threads - Maximum</option>
                            </select>
                        </div>
                        <div class="option-group">
                            <label>üìä Scrape Limit</label>
                            <input type="number" id="scrapeLimit" class="option-input" value="20" min="5" max="50" step="5">
                        </div>
                        <div class="option-group">
                            <label>üéØ Analysis Depth</label>
                            <select id="analysisDepth" class="option-select">
                                <option value="standard">Standard Analysis</option>
                                <option value="deep" selected>Deep Analysis</option>
                                <option value="comprehensive">Comprehensive Scan</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Loading Section -->
        <div id="loadingSection" class="loading-section">
            <div class="loading-content">
                <div class="spinner-container">
                    <div class="spinner"></div>
                    <div class="spinner-inner"></div>
                </div>
                <div class="loading-text">Investigation in Progress...</div>
                <div class="loading-subtext" id="loadingSubtext">Initializing search engines...</div>
                <div class="loading-progress" id="loadingProgress">0%</div>
                <div class="progress-steps">
                    <div class="progress-step" id="step1">
                        <div class="step-icon">üéØ</div>
                        <div>Query Analysis</div>
                    </div>
                    <div class="progress-step" id="step2">
                        <div class="step-icon">üîç</div>
                        <div>Search Engines</div>
                    </div>
                    <div class="progress-step" id="step3">
                        <div class="step-icon">üì°</div>
                        <div>Data Scraping</div>
                    </div>
                    <div class="progress-step" id="step4">
                        <div class="step-icon">üíé</div>
                        <div>Artifact Extraction</div>
                    </div>
                    <div class="progress-step" id="step5">
                        <div class="step-icon">üõ°Ô∏è</div>
                        <div>Threat Analysis</div>
                    </div>
                    <div class="progress-step" id="step6">
                        <div class="step-icon">üìä</div>
                        <div>Report Generation</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <!-- Results Header -->
            <div class="results-header">
                <div class="investigation-header">
                    <div class="investigation-info">
                        <h3 id="investigationTitle">Investigation Results</h3>
                        <div class="investigation-meta">
                            <div class="meta-item">
                                <span>üÜî</span>
                                <span id="investigationId"></span>
                            </div>
                            <div class="meta-item">
                                <span>‚è∞</span>
                                <span id="investigationTime"></span>
                            </div>
                            <div class="meta-item">
                                <span>ü§ñ</span>
                                <span id="investigationModel"></span>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-panel" id="comparisonPanel">
                        <h4 style="color: var(--orange); margin-bottom: 1rem;">Compare with Previous Investigation</h4>
                        <div id="comparisonContent"></div>
                    </div>

                    <div class="meta-item">
                        <span>üìä</span>
                        <span id="investigationStatus"></span>
                    </div>

                    <div class="export-buttons">
                        <button class="export-btn" id="exportPdfBtn">
                            <span>üìÑ</span>
                            <span>Export PDF</span>
                        </button>
                        <button class="export-btn" id="exportJsonBtn">
                            <span>üíæ</span>
                            <span>Export JSON</span>
                        </button>
                        <button class="export-btn" id="exportCsvBtn">
                            <span>üìä</span>
                            <span>Export CSV</span>
                        </button>
                        <button class="export-btn" id="shareBtn">
                            <span>üîó</span>
                            <span>Share</span>
                        </button>
                        <button class="export-btn" id="printBtn">
                            <span>üñ®Ô∏è</span>
                            <span>Print</span>
                        </button>
                        <button class="export-btn" id="compareBtn">
                            <span>‚öñÔ∏è</span>
                            <span>Compare</span>
                        </button>
                    </div>
                </div>
                <div class="query-analysis" id="queryAnalysis"></div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid" id="statsGrid"></div>

            <!-- Threat Analysis -->
            <div id="threatSection" class="threat-analysis"></div>

            <!-- Artifacts -->
            <div id="artifactsSection" class="artifacts-section"></div>

            <!-- Sources -->
            <div id="sourcesSection" class="sources-section"></div>

            <!-- Report -->
            <div class="report-section">
                <h3>üìä Comprehensive Intelligence Report</h3>
                <div class="report-actions">
                    <button class="report-action-btn" id="copyReportBtn">üìã Copy Report</button>
                    <button class="report-action-btn" id="downloadTxtBtn">üíæ Download TXT</button>
                </div>
                <div class="report-content" id="reportContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://127.0.0.1:5000/donna';
        
        // State
        let currentInvestigation = null;
        let selectedModel = 'ollama';
        let alertTimeout = null;

        // DOM Elements
        const searchForm = document.getElementById('searchForm');
        const searchQuery = document.getElementById('searchQuery');
        const searchBtn = document.getElementById('searchBtn');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');
        const alertContainer = document.getElementById('alertContainer');
        const modelSelectorBtn = document.getElementById('modelSelectorBtn');
        const modelDropdown = document.getElementById('modelDropdown');
        const currentModelSpan = document.getElementById('currentModel');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkSystemHealth();
            loadPreviousInvestigation();
            setupModelSelector();
            setupEventListeners();
        });

        // Model Selector
        function setupModelSelector() {
            modelSelectorBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                modelDropdown.classList.toggle('active');
            });

            document.addEventListener('click', () => {
                modelDropdown.classList.remove('active');
            });

            document.querySelectorAll('.model-option').forEach(option => {
                option.addEventListener('click', (e) => {  // ADD (e) parameter
                    e.stopPropagation(); // ADD THIS LINE
                    document.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    selectedModel = option.dataset.model;
                    const modelName = selectedModel === 'ollama' ? 'Ollama (Local)' : 'Google Gemini (Cloud)';
                    currentModelSpan.textContent = modelName;
                    
                    document.getElementById('modelSelectorBtn').querySelector('span:nth-child(2)').textContent = modelName;
                    console.log('Model switched to:', selectedModel); // Debug line
                    
                    showAlert(`Switched to ${modelName}`, 'success');
                    modelDropdown.classList.remove('active');
                });
            });
        }

        // Event Listeners
        function setupEventListeners() {
            document.getElementById('copyReportBtn').addEventListener('click', copyReport);
            document.getElementById('downloadTxtBtn').addEventListener('click', downloadTxtReport);
            document.getElementById('exportPdfBtn').addEventListener('click', exportPdf);
            document.getElementById('exportJsonBtn').addEventListener('click', exportJson);
            document.getElementById('shareBtn').addEventListener('click', shareInvestigation);
            document.getElementById('exportCsvBtn').addEventListener('click', exportCsv);
            document.getElementById('printBtn').addEventListener('click', printReport);
            document.getElementById('compareBtn').addEventListener('click', toggleComparison);
        }

        // Check System Health
        async function checkSystemHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (data.status === 'OPERATIONAL') {
                    document.getElementById('systemStatus').textContent = 'System Online';
                    updateSystemStatus(data.systems);
                } else {
                    showAlert('System health check failed', 'error');
                }
            } catch (error) {
                showAlert('Unable to connect to backend server', 'error');
                document.getElementById('systemStatus').textContent = 'System Offline';
            }
        }

        function updateSystemStatus(systems) {
            console.log('System Status:', systems);
        }

        function toggleComparison() {
            const panel = document.getElementById('comparisonPanel');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                loadComparisonData();
            }
        }

        function loadComparisonData() {
            const previous = localStorage.getItem('donna_previous_investigation');
            if (!previous || !currentInvestigation) {
                document.getElementById('comparisonContent').innerHTML = 
                    '<p style="color: var(--text-secondary);">No previous investigation to compare</p>';
                return;
            }
            
            const prev = JSON.parse(previous);
            const curr = currentInvestigation;
            
            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.3rem;">Artifacts Change</div>
                        <div style="font-size: 1.5rem; color: ${curr.artifacts.summary.total_artifacts > prev.artifacts.summary.total_artifacts ? 'var(--success)' : 'var(--error)'};">
                            ${curr.artifacts.summary.total_artifacts > prev.artifacts.summary.total_artifacts ? '‚ñ≤' : '‚ñº'}
                            ${Math.abs(curr.artifacts.summary.total_artifacts - prev.artifacts.summary.total_artifacts)}
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.3rem;">Threat Level</div>
                        <div style="font-size: 1.5rem; color: var(--orange);">
                            ${prev.threat_analysis.level} ‚Üí ${curr.threat_analysis.level}
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.3rem;">Processing Time</div>
                        <div style="font-size: 1.5rem; color: ${curr.statistics.investigation_duration_seconds < prev.statistics.investigation_duration_seconds ? 'var(--success)' : 'var(--warning)'};">
                            ${curr.statistics.investigation_duration_seconds.toFixed(1)}s
                            (${curr.statistics.investigation_duration_seconds < prev.statistics.investigation_duration_seconds ? 'Faster' : 'Slower'})
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('comparisonContent').innerHTML = html;
        }

        // Search Form Handler
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const query = searchQuery.value.trim();
            const originalQuery = query;

            if (!query || query.length < 3) {
                showAlert('Please enter a search query (minimum 3 characters)', 'error');
                return;
            }

            await startInvestigation(query);
        });

        // Start Investigation
        async function startInvestigation(query) {
            // Reset UI
            resultsSection.classList.remove('active');
            loadingSection.classList.add('active');
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<span>‚è≥ Investigating...</span>';

            setTimeout(() => { searchQuery.value = originalQuery; }, 0);
            
            // Reset progress
            for (let i = 1; i <= 6; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
            }

            try {
                // Simulate progress
                simulateProgress();

                const response = await fetch(`${API_BASE_URL}/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        threads: parseInt(document.getElementById('threadCount').value),
                        scrape_limit: parseInt(document.getElementById('scrapeLimit').value),
                        model: selectedModel
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success) {
                    currentInvestigation = data;
                    displayResults(data);
                    saveInvestigation(data);
                    showAlert('‚úÖ Investigation completed successfully!', 'success');
                } else {
                    throw new Error(data.error || 'Investigation failed');
                }
            } catch (error) {
                console.error('Investigation error:', error);
                showAlert(`‚ùå Investigation failed: ${error.message}`, 'error');
            } finally {
                loadingSection.classList.remove('active');
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<span>üöÄ Start Investigation</span>';
            }
        }

        // Simulate Progress
        function simulateProgress() {
            const steps = [
                { id: 1, text: 'Analyzing query with AI...', delay: 500, progress: 10 },
                { id: 2, text: 'Searching across dark web engines...', delay: 2000, progress: 25 },
                { id: 3, text: 'Scraping discovered sources...', delay: 5000, progress: 50 },
                { id: 4, text: 'Extracting intelligence artifacts...', delay: 7000, progress: 70 },
                { id: 5, text: 'Analyzing threat indicators...', delay: 9000, progress: 85 },
                { id: 6, text: 'Generating comprehensive report...', delay: 11000, progress: 95 }
            ];

            let currentStep = 0;
            const updateInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    document.getElementById(`step${step.id}`).classList.add('active');
                    document.getElementById('loadingSubtext').textContent = step.text;
                    
                    // Animate progress
                    let currentProgress = currentStep === 0 ? 0 : steps[currentStep - 1].progress;
                    const targetProgress = step.progress;
                    const progressEl = document.getElementById('loadingProgress');
                    
                    const animateProgress = setInterval(() => {
                        if (currentProgress < targetProgress) {
                            currentProgress += 1;
                            progressEl.textContent = `${currentProgress}%`;
                        } else {
                            clearInterval(animateProgress);
                        }
                    }, 30);
                    
                    if (currentStep > 0) {
                        document.getElementById(`step${step.id - 1}`).classList.remove('active');
                        document.getElementById(`step${step.id - 1}`).classList.add('completed');
                    }
                    
                    currentStep++;
                } else {
                    clearInterval(updateInterval);
                }
            }, 2000);
        }

        // Display Results
        function displayResults(data) {
            resultsSection.classList.add('active');
            
            // Investigation Title
            document.getElementById('investigationTitle').textContent = 
                `Investigation: ${data.query_analysis?.original || 'Unknown Query'}`;
            
            document.getElementById('investigationId').textContent = data.investigation_id || 'N/A';
            document.getElementById('investigationTime').textContent = new Date(data.timestamp).toLocaleString();
            document.getElementById('investigationModel').textContent = 
                selectedModel === 'ollama' ? 'Ollama LLaMA 3.2' : 'Google Gemini';
            
            const statusBadge = document.getElementById('investigationStatus');
            const status = data.statistics?.status || 'COMPLETED';
            statusBadge.innerHTML = `<span style="padding: 0.3rem 0.8rem; background: var(--success); color: white; border-radius: 6px; font-weight: 700; font-size: 0.85rem;">${status}</span>`;

            // Query Analysis
            displayQueryAnalysis(data.query_analysis);

            // Statistics
            displayStatistics(data.statistics);

            displayDetailedStats(data.statistics, data.artifacts);

            // Threat Analysis
            displayThreatAnalysis(data.threat_analysis);

            // Artifacts
            displayArtifacts(data.artifacts);

            // Sources
            displaySources(data.sources);

            // Report
            document.getElementById('reportContent').textContent = data.report;

            // Scroll to results
            setTimeout(() => {
                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // Display Query Analysis
        function displayQueryAnalysis(analysis) {
            const queryAnalysis = document.getElementById('queryAnalysis');
            
            const html = `
                <div class="query-detail">
                    <div class="query-label">Original Query</div>
                    <div class="query-value">${analysis.original}</div>
                </div>
                <div class="query-detail">
                    <div class="query-label">Refined Query</div>
                    <div class="query-value">${analysis.refined}</div>
                </div>
                <div class="query-detail">
                    <div class="query-label">Keywords Extracted</div>
                    <div class="query-value">${analysis.keywords?.length || 0} keywords</div>
                </div>
                <div class="query-detail">
                    <div class="query-label">Search Variations</div>
                    <div class="query-value">${analysis.variations?.length || 0} variations</div>
                </div>
                
                ${analysis.variations && analysis.variations.length > 0 ? `
                    <div class="query-detail" style="grid-column: 1 / -1;">
                        <div class="query-label">Variations Used</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                            ${analysis.variations.map(v => `
                                <span style="padding: 0.4rem 0.8rem; background: var(--charcoal); border: 1px solid var(--orange); border-radius: 6px; font-size: 0.85rem;">${v}</span>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
            
            queryAnalysis.innerHTML = html;
        }

        // Display Statistics
        function displayStatistics(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';

            const statCards = [
                { 
                    label: 'Search Results', 
                    value: stats.total_search_results || 0, 
                    icon: 'üîç',
                    description: 'Total URLs discovered across all engines'
                },
                { 
                    label: 'Sources Scraped', 
                    value: stats.successfully_scraped || 0, 
                    icon: 'üì°',
                    description: 'Successfully analyzed sources'
                },
                { 
                    label: 'Artifacts Extracted', 
                    value: stats.artifacts_extracted || 0, 
                    icon: 'üíé',
                    description: 'Unique intelligence artifacts found'
                },
                { 
                    label: 'Investigation Time', 
                    value: `${(stats.investigation_duration_seconds || 0).toFixed(1)}s`, 
                    icon: '‚è±Ô∏è',
                    description: 'Total processing time'
                },
                { 
                    label: 'Threat Level', 
                    value: stats.threat_level || 'UNKNOWN', 
                    icon: '‚ö†Ô∏è',
                    description: `Risk Score: ${((stats.threat_score || 0) * 100).toFixed(0)}%`
                },
                { 
                    label: 'Refined Terms', 
                    value: (stats.refined_query || '').split(' ').filter(t => t).length, 
                    icon: 'üéØ',
                    description: stats.refined_query || 'N/A'
                }
            ];

            statCards.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'stat-card slide-up';
                card.innerHTML = `
                    <div class="stat-header">
                        <span class="stat-label">${stat.label}</span>
                        <span class="stat-icon">${stat.icon}</span>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-description">${stat.description}</div>
                `;
                statsGrid.appendChild(card);
            });
        }

        function displayDetailedStats(stats, artifacts) {
            const detailedSection = document.createElement('div');
            detailedSection.className = 'detailed-stats slide-up';
            
            const crypto = artifacts.crypto_addresses || {};
            const totalBTC = crypto.bitcoin?.length || 0;
            const totalETH = crypto.ethereum?.length || 0;
            const totalXMR = crypto.monero?.length || 0;
            const totalLTC = crypto.litecoin?.length || 0;
            
            const hashes = artifacts.hashes || {};
            const totalMD5 = hashes.md5?.length || 0;
            const totalSHA256 = hashes.sha256?.length || 0;
            const totalSHA512 = hashes.sha512?.length || 0;
            
            const social = artifacts.social_media || {};
            const totalTwitter = social.twitter?.length || 0;
            const totalTelegram = social.telegram?.length || 0;
            
            detailedSection.innerHTML = `
                <h4>üìä Detailed Intelligence Breakdown</h4>
                <div class="stats-breakdown">
                    <div class="breakdown-item">
                        <div class="breakdown-label">Bitcoin Addresses</div>
                        <div class="breakdown-value">${totalBTC}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Ethereum Addresses</div>
                        <div class="breakdown-value">${totalETH}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Monero Addresses</div>
                        <div class="breakdown-value">${totalXMR}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Litecoin Addresses</div>
                        <div class="breakdown-value">${totalLTC}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">MD5 Hashes</div>
                        <div class="breakdown-value">${totalMD5}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">SHA256 Hashes</div>
                        <div class="breakdown-value">${totalSHA256}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">SHA512 Hashes</div>
                        <div class="breakdown-value">${totalSHA512}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Twitter Accounts</div>
                        <div class="breakdown-value">${totalTwitter}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Telegram Channels</div>
                        <div class="breakdown-value">${totalTelegram}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Avg Scrape Time</div>
                        <div class="breakdown-value">${(stats.average_scrape_time || 0).toFixed(2)}s</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">API Keys Found</div>
                        <div class="breakdown-value">${artifacts.api_keys?.length || 0}</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-label">Private Keys Found</div>
                        <div class="breakdown-value" style="color: var(--critical);">${artifacts.private_keys?.length || 0}</div>
                    </div>
                </div>
            `;
            
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.insertAdjacentElement('afterend', detailedSection);
        }

        // Display Threat Analysis
        function displayThreatAnalysis(threat) {
            const threatSection = document.getElementById('threatSection');
            
            const levelClass = threat.level.toLowerCase();
            const scorePercent = ((threat.score || 0) * 100).toFixed(0);

            let html = `
                <h3>üõ°Ô∏è Comprehensive Threat Analysis</h3>
                <div class="threat-level-container">
                    <div class="threat-badge ${levelClass}">${threat.level}</div>
                    <div class="threat-score-container">
                        <div class="score-header">
                            <span>Threat Score Assessment</span>
                            <span style="color: var(--orange); font-weight: 800;">${scorePercent}%</span>
                        </div>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${scorePercent}%;"></div>
                        </div>
                    </div>
                </div>
                <div class="threat-description">
                    ${threat.severity_description || 'No description available'}
                </div>
                <div class="threat-sections">
            `;

            // Threat Indicators
            if (threat.indicators && threat.indicators.length > 0) {
                html += `
                    <div class="threat-section-card">
                        <div class="threat-section-title">
                            <span>‚ö†Ô∏è</span>
                            <span>Threat Indicators (${threat.indicators.length})</span>
                        </div>
                        <div class="indicator-list">
                `;
                threat.indicators.forEach((indicator, index) => {
                    html += `
                        <div class="indicator-item">
                            <div class="indicator-number">${index + 1}</div>
                            <div class="indicator-text">${indicator}</div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }

            // Risk Factors
            if (threat.risk_factors && threat.risk_factors.length > 0) {
                html += `
                    <div class="threat-section-card">
                        <div class="threat-section-title" style="color: var(--error);">
                            <span>üö®</span>
                            <span>Critical Risk Factors (${threat.risk_factors.length})</span>
                        </div>
                        <div class="indicator-list">
                `;
                threat.risk_factors.forEach((risk, index) => {
                    html += `
                        <div class="indicator-item" style="border-left-color: var(--error);">
                            <div class="indicator-number" style="background: var(--error);">${index + 1}</div>
                            <div class="indicator-text">${risk}</div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }

            html += `</div>`;
            threatSection.innerHTML = html;
        }

        // Display Artifacts
        function displayArtifacts(artifacts) {
            const artifactsSection = document.getElementById('artifactsSection');
            
            const summary = artifacts.summary || {};
            
            let html = `
                <h3>üíé Extracted Intelligence Artifacts</h3>
                <div class="artifacts-summary">
                    <div class="summary-item">
                        <div class="summary-value">${summary.total_artifacts || 0}</div>
                        <div class="summary-label">Total Artifacts</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${summary.total_emails || 0}</div>
                        <div class="summary-label">Email Addresses</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${summary.total_crypto || 0}</div>
                        <div class="summary-label">Crypto Wallets</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${summary.total_ips || 0}</div>
                        <div class="summary-label">IP Addresses</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${summary.total_domains || 0}</div>
                        <div class="summary-label">Domains</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${summary.total_hashes || 0}</div>
                        <div class="summary-label">File Hashes</div>
                    </div>
                </div>
                <div class="artifacts-grid">
            `;

            html += `
                <div class="artifact-filters">
                    <button class="filter-btn active" data-filter="all">All Artifacts</button>
                    <button class="filter-btn" data-filter="crypto">Cryptocurrency</button>
                    <button class="filter-btn" data-filter="network">Network</button>
                    <button class="filter-btn" data-filter="identity">Identity</button>
                    <button class="filter-btn" data-filter="security">Security</button>
                </div>
                <div class="artifacts-grid" id="artifactsGrid">
            `;

            artifactsSection.innerHTML = html;
            setupArtifactFilters();

        function setupArtifactFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const filter = btn.dataset.filter;
                    const categories = document.querySelectorAll('.artifact-category');
                    
                    categories.forEach(cat => {
                        const title = cat.querySelector('.category-title').textContent.toLowerCase();
                        let show = filter === 'all';
                        
                        if (filter === 'crypto' && (title.includes('bitcoin') || title.includes('ethereum') || title.includes('monero') || title.includes('litecoin'))) show = true;
                        if (filter === 'network' && (title.includes('ip') || title.includes('domain') || title.includes('url'))) show = true;
                        if (filter === 'identity' && (title.includes('email') || title.includes('phone') || title.includes('twitter') || title.includes('telegram'))) show = true;
                        if (filter === 'security' && (title.includes('hash') || title.includes('api') || title.includes('key'))) show = true;
                        
                        cat.style.display = show ? 'block' : 'none';
                    });
                });
            });
        }

            // Email Addresses
            if (artifacts.emails && artifacts.emails.length > 0) {
                html += createArtifactCategory('üìß Email Addresses', artifacts.emails);
            }

            // Domains
            if (artifacts.domains && artifacts.domains.length > 0) {
                html += createArtifactCategory('üåê Domain Names', artifacts.domains);
            }

            // IP Addresses
            if (artifacts.ip_addresses && artifacts.ip_addresses.length > 0) {
                html += createArtifactCategory('üñ•Ô∏è IP Addresses', artifacts.ip_addresses);
            }

            // Bitcoin
            if (artifacts.crypto_addresses?.bitcoin?.length > 0) {
                html += createArtifactCategory('‚Çø Bitcoin Wallets', artifacts.crypto_addresses.bitcoin, true);
            }

            // Ethereum
            if (artifacts.crypto_addresses?.ethereum?.length > 0) {
                html += createArtifactCategory('üí† Ethereum Wallets', artifacts.crypto_addresses.ethereum, true);
            }

            // Monero
            if (artifacts.crypto_addresses?.monero?.length > 0) {
                html += createArtifactCategory('üîí Monero Wallets', artifacts.crypto_addresses.monero, true);
            }

            // Litecoin
            if (artifacts.crypto_addresses?.litecoin?.length > 0) {
                html += createArtifactCategory('≈Å Litecoin Wallets', artifacts.crypto_addresses.litecoin, true);
            }

            // URLs
            if (artifacts.urls && artifacts.urls.length > 0) {
                html += createArtifactCategory('üîó URLs', artifacts.urls);
            }

            // Phone Numbers
            if (artifacts.phone_numbers && artifacts.phone_numbers.length > 0) {
                html += createArtifactCategory('üì± Phone Numbers', artifacts.phone_numbers);
            }

            // SHA256 Hashes
            if (artifacts.hashes?.sha256?.length > 0) {
                html += createArtifactCategory('üîê SHA256 Hashes', artifacts.hashes.sha256, true);
            }

            // MD5 Hashes
            if (artifacts.hashes?.md5?.length > 0) {
                html += createArtifactCategory('üîë MD5 Hashes', artifacts.hashes.md5, true);
            }

            // SHA512 Hashes
            if (artifacts.hashes?.sha512?.length > 0) {
                html += createArtifactCategory('üîì SHA512 Hashes', artifacts.hashes.sha512, true);
            }

            // Twitter
            if (artifacts.social_media?.twitter?.length > 0) {
                html += createArtifactCategory('üê¶ Twitter Accounts', artifacts.social_media.twitter);
            }

            // Telegram
            if (artifacts.social_media?.telegram?.length > 0) {
                html += createArtifactCategory('‚úàÔ∏è Telegram Channels', artifacts.social_media.telegram);
            }

            // API Keys
            if (artifacts.api_keys && artifacts.api_keys.length > 0) {
                html += `
                    <div class="artifact-category" style="border-color: var(--warning);">
                        <div class="category-header">
                            <span class="category-title" style="color: var(--warning);">üîê API Keys/Tokens</span>
                            <span class="category-count" style="background: var(--warning);">${artifacts.api_keys.length}</span>
                        </div>
                        <div style="padding: 1rem; background: rgba(251, 191, 36, 0.1); border-radius: 8px; color: var(--warning);">
                            <strong>‚ö†Ô∏è SENSITIVE DATA DETECTED</strong>
                            <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                                Potential API keys or authentication tokens discovered. Manual verification required.
                            </p>
                        </div>
                    </div>
                `;
            }

            // Private Keys
            if (artifacts.private_keys && artifacts.private_keys.length > 0) {
                html += `
                    <div class="artifact-category" style="border: 2px solid var(--critical); animation: badgePulse 2s infinite;">
                        <div class="category-header">
                            <span class="category-title" style="color: var(--critical);">üö® PRIVATE KEYS</span>
                            <span class="category-count" style="background: var(--critical);">${artifacts.private_keys.length}</span>
                        </div>
                        <div style="padding: 1.5rem; background: rgba(220, 38, 38, 0.15); border-radius: 8px; color: var(--critical);">
                            <strong style="font-size: 1.1rem;">‚ö†Ô∏è CRITICAL SECURITY EXPOSURE</strong>
                            <p style="margin-top: 0.8rem; line-height: 1.6;">
                                Private cryptographic key material detected in sources. This represents a severe security risk and potential credential compromise.
                            </p>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            
            if (summary.total_artifacts === 0) {
                html += '<div class="no-artifacts">No artifacts were extracted from the analyzed sources.</div>';
            }

            artifactsSection.innerHTML = html;
        }

        function setupArtifactFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const filter = btn.dataset.filter;
                    const categories = document.querySelectorAll('.artifact-category');
                    
                    categories.forEach(cat => {
                        const title = cat.querySelector('.category-title').textContent.toLowerCase();
                        let show = filter === 'all';
                        
                        if (filter === 'crypto' && (title.includes('bitcoin') || title.includes('ethereum') || title.includes('monero') || title.includes('litecoin'))) show = true;
                        if (filter === 'network' && (title.includes('ip') || title.includes('domain') || title.includes('url'))) show = true;
                        if (filter === 'identity' && (title.includes('email') || title.includes('phone') || title.includes('twitter') || title.includes('telegram'))) show = true;
                        if (filter === 'security' && (title.includes('hash') || title.includes('api') || title.includes('key'))) show = true;
                        
                        cat.style.display = show ? 'block' : 'none';
                    });
                });
            });
        }

        // Create Artifact Category
        function createArtifactCategory(title, items, truncate = false) {
            const count = items.length;
            const displayLimit = 15;
            const itemsToShow = items.slice(0, displayLimit);
            
            let html = `
                <div class="artifact-category">
                    <div class="category-header">
                        <span class="category-title">${title}</span>
                        <span class="category-count">${count}</span>
                    </div>
                    <div class="artifact-list">
            `;

            itemsToShow.forEach(item => {
                const value = item.value || item;
                const confidence = item.confidence ? (item.confidence * 100).toFixed(0) : 90;
                let displayValue = value;
                
                if (truncate && value.length > 30) {
                    displayValue = value.substring(0, 30) + '...';
                }
                
                const context = item.context ? ` - ${item.context}` : '';
                html += `
                    <div class="artifact-item" title="${value}${context}" style="flex-direction: column; align-items: stretch;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="artifact-value">${displayValue}</span>
                            <span class="confidence-badge">${confidence}%</span>
                        </div>
                        ${item.context ? `
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.3rem; font-style: italic;">
                                Context: ${item.context}
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            if (count > displayLimit) {
                html += `
                    <div style="text-align: center; padding: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                        ... and ${count - displayLimit} more items
                    </div>
                `;
            }

            html += `</div></div>`;
            return html;
        }

        // Display Sources
        function displaySources(sources) {
            const sourcesSection = document.getElementById('sourcesSection');
            
            if (!sources || sources.length === 0) {
                sourcesSection.style.display = 'none';
                return;
            }

            sourcesSection.style.display = 'block';
            
            let html = `
                <h3>üåê Analyzed Sources (${sources.length})</h3>
                <div class="sources-list">
            `;

            sources.forEach((source, index) => {
                const isOnion = source.includes('.onion');
                html += `
                    <div class="source-item">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px;">
                                <span class="source-type">${isOnion ? 'ONION' : 'CLEARNET'}</span>
                                <div class="source-url">${index + 1}. ${source}</div>
                            </div>
                            ${typeof source === 'object' && source.source ? `
                                <div style="font-size: 0.8rem; color: var(--text-secondary); padding: 0.3rem 0.6rem; background: var(--charcoal); border-radius: 4px;">
                                    via ${source.source}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            sourcesSection.innerHTML = html;
        }

        // Copy Report
        function copyReport() {
            const reportText = document.getElementById('reportContent').textContent;
            navigator.clipboard.writeText(reportText).then(() => {
                showAlert('üìã Report copied to clipboard!', 'success');
                showCopiedFeedback();
            }).catch(err => {
                showAlert('Failed to copy report', 'error');
            });
        }

        function showCopiedFeedback() {
            const feedback = document.createElement('div');
            feedback.className = 'copied-feedback';
            feedback.textContent = '‚úì Copied to clipboard!';
            document.body.appendChild(feedback);
            setTimeout(() => feedback.remove(), 2000);
        }

        // Download TXT Report
        function downloadTxtReport() {
            if (!currentInvestigation) {
                showAlert('No investigation data available', 'error');
                return;
            }

            const reportText = document.getElementById('reportContent').textContent;
            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DONNA_Report_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            showAlert('üìÑ TXT report downloaded!', 'success');
        }

        // Export PDF
        async function exportPdf() {
            if (!currentInvestigation) {
                showAlert('No investigation data to export', 'error');
                return;
            }

            try {
                showAlert('‚è≥ Generating PDF report...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/export-pdf`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        report: currentInvestigation.report,
                        query: currentInvestigation.query_analysis.original,
                        artifacts: currentInvestigation.artifacts,
                        threat_analysis: currentInvestigation.threat_analysis,
                        statistics: currentInvestigation.statistics
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `DONNA_Intelligence_${Date.now()}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showAlert('‚úÖ PDF report exported successfully!', 'success');
                } else {
                    throw new Error('PDF export failed');
                }
            } catch (error) {
                console.error('PDF export error:', error);
                showAlert('‚ùå Failed to export PDF report', 'error');
            }
        }

        // Export JSON
        function exportJson() {
            if (!currentInvestigation) {
                showAlert('No investigation data to export', 'error');
                return;
            }

            try {
                const dataStr = JSON.stringify(currentInvestigation, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `DONNA_Investigation_${currentInvestigation.investigation_id}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showAlert('‚úÖ JSON data exported successfully!', 'success');
            } catch (error) {
                console.error('JSON export error:', error);
                showAlert('‚ùå Failed to export JSON data', 'error');
            }
        }


        function exportCsv() {
            if (!currentInvestigation) {
                showAlert('No investigation data to export', 'error');
                return;
            }

            try {
                const artifacts = currentInvestigation.artifacts;
                let csv = 'Type,Value,Confidence,Context\n';
                
                // Emails
                (artifacts.emails || []).forEach(item => {
                    csv += `"Email","${item.value}","${(item.confidence * 100).toFixed(0)}%","${item.context || ''}"\n`;
                });
                
                // Domains
                (artifacts.domains || []).forEach(item => {
                    csv += `"Domain","${item.value}","${(item.confidence * 100).toFixed(0)}%","${item.context || ''}"\n`;
                });
                
                // IPs
                (artifacts.ip_addresses || []).forEach(item => {
                    csv += `"IP Address","${item.value}","${(item.confidence * 100).toFixed(0)}%",""\n`;
                });
                
                // Bitcoin
                (artifacts.crypto_addresses?.bitcoin || []).forEach(item => {
                    csv += `"Bitcoin","${item.value}","${(item.confidence * 100).toFixed(0)}%",""\n`;
                });
                
                // Ethereum
                (artifacts.crypto_addresses?.ethereum || []).forEach(item => {
                    csv += `"Ethereum","${item.value}","${(item.confidence * 100).toFixed(0)}%",""\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `DONNA_Artifacts_${Date.now()}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showAlert('‚úÖ CSV exported successfully!', 'success');
            } catch (error) {
                console.error('CSV export error:', error);
                showAlert('‚ùå Failed to export CSV', 'error');
            }
        }

        function printReport() {
            window.print();
        }

        // Share Investigation
        function shareInvestigation() {
            if (!currentInvestigation) {
                showAlert('No investigation data to share', 'error');
                return;
            }

            const shareUrl = `${window.location.origin}?investigation=${currentInvestigation.investigation_id}`;
            
            navigator.clipboard.writeText(shareUrl).then(() => {
                showAlert('üîó Investigation link copied to clipboard!', 'success');
            }).catch(() => {
                showAlert('Failed to copy link', 'error');
            });
        }

        // Show Alert
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };
            
            alert.innerHTML = `
                <span class="alert-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
                <div class="alert-content">${message}</div>
                <span class="alert-close" onclick="this.parentElement.remove()">‚úï</span>
            `;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Save/Load Investigation
        function saveInvestigation(data) {
            try {
                const previous = localStorage.getItem('donna_last_investigation');
                if (previous) {
                    localStorage.setItem('donna_previous_investigation', previous);
                }
                localStorage.setItem('donna_last_investigation', JSON.stringify(data));
            } catch (error) {
                console.error('Error saving investigation:', error);
            }
        }

        function loadPreviousInvestigation() {
            try {
                const saved = localStorage.getItem('donna_last_investigation');
                if (saved) {
                    const data = JSON.parse(saved);
                    const timestamp = new Date(data.timestamp);
                    const hoursDiff = (new Date() - timestamp) / (1000 * 60 * 60);
                    
                    if (hoursDiff < 24) {
                        currentInvestigation = data;
                    }
                }
            } catch (error) {
                console.error('Error loading previous investigation:', error);
            }
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                if (document.activeElement === searchQuery) {
                    searchForm.dispatchEvent(new Event('submit'));
                }
            }
            
            if (e.key === 'Escape') {
                searchQuery.value = '';
                searchQuery.focus();
                modelDropdown.classList.remove('active');
            }

            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && currentInvestigation) {
                if (window.getSelection().toString() === '') {
                    copyReport();
                }
            }
        });

        // Auto-focus
        window.addEventListener('load', () => {
            searchQuery.focus();
        });

        // Periodic health check
        setInterval(checkSystemHealth, 300000);

        // Console branding
        console.log('%cüîç DONNA AI Frontend Initialized', 'color: #ff6b35; font-size: 18px; font-weight: bold;');
        console.log('%cVersion: 3.0 Ultimate Edition', 'color: #a0a0a0; font-size: 12px;');
        console.log('%cBackend: ' + API_BASE_URL, 'color: #a0a0a0; font-size: 12px;');
        console.log('%c‚ö° Professional OSINT Platform Ready', 'color: #4ade80; font-size: 12px;');
    </script>
</body>
</html>