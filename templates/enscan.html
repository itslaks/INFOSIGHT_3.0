<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Site Index - Advanced Security Scanner</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-dark: #0a0e27;
        --secondary-dark: #151930;
        --accent-purple: #9333ea;
        --accent-pink: #ec4899;
        --accent-cyan: #06b6d4;
        --accent-green: #10b981;
        --accent-red: #ef4444;
        --accent-orange: #f59e0b;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --border-color: #1e293b;
        --card-bg: #0f172a;
        --success: #22c55e;
        --warning: #eab308;
        --danger: #dc2626;
        --gradient-1: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
        --gradient-2: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
        --gradient-3: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
        --glow-purple: 0 0 20px rgba(147, 51, 234, 0.4);
        --glow-pink: 0 0 20px rgba(236, 72, 153, 0.4);
        --glow-cyan: 0 0 20px rgba(6, 182, 212, 0.4);
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--primary-dark);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
        position: relative;
      }

      /* Animated Background */
      .bg-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        opacity: 0.15;
        pointer-events: none;
      }

      .bg-animation::before,
      .bg-animation::after {
        content: "";
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        animation: float 20s ease-in-out infinite;
      }

      .bg-animation::before {
        width: 600px;
        height: 600px;
        background: var(--gradient-1);
        top: -200px;
        left: -200px;
        animation-delay: 0s;
      }

      .bg-animation::after {
        width: 500px;
        height: 500px;
        background: var(--gradient-2);
        bottom: -150px;
        right: -150px;
        animation-delay: 10s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        33% {
          transform: translate(100px, -100px) scale(1.1);
        }
        66% {
          transform: translate(-50px, 100px) scale(0.9);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }

      ::-webkit-scrollbar-track {
        background: var(--secondary-dark);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--accent-purple);
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--accent-pink);
      }

      /* Container */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 1;
      }

      /* Header */
      .header {
        text-align: center;
        padding: 40px 20px;
        margin-bottom: 40px;
        position: relative;
      }

      .logo {
        display: inline-flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        position: relative;
      }

      .logo-icon {
        width: 60px;
        height: 60px;
        background: var(--gradient-1);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        box-shadow: var(--glow-purple);
        animation: pulse 3s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: var(--glow-purple);
        }
        50% {
          transform: scale(1.05);
          box-shadow: var(--glow-pink);
        }
      }

      .logo-text {
        text-align: left;
      }

      .logo-text h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--gradient-1);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -1px;
      }

      .logo-text p {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 500;
        letter-spacing: 2px;
        text-transform: uppercase;
      }

      .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.8;
      }

      /* Scan Box */
      .scan-box {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .scan-box::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-1);
      }

      .input-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
      }

      .input-wrapper {
        flex: 1;
        position: relative;
      }

      .input-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        font-size: 20px;
        pointer-events: none;
      }

      input[type="text"] {
        width: 100%;
        padding: 18px 20px 18px 55px;
        background: var(--secondary-dark);
        border: 2px solid var(--border-color);
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 1rem;
        font-family: "Fira Code", monospace;
        transition: all 0.3s ease;
      }

      input[type="text"]:focus {
        outline: none;
        border-color: var(--accent-purple);
        box-shadow: 0 0 0 4px rgba(147, 51, 234, 0.1);
      }

      input[type="text"]::placeholder {
        color: var(--text-muted);
      }

      .btn {
        padding: 18px 40px;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
      }

      .btn-primary {
        background: var(--gradient-1);
        color: white;
        box-shadow: var(--shadow-md);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg), var(--glow-purple);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-icon {
        display: inline-flex;
        align-items: center;
        gap: 10px;
      }

      /* Loading State */
      .loading {
        display: none;
        align-items: center;
        justify-content: center;
        gap: 15px;
        padding: 20px;
        background: var(--secondary-dark);
        border-radius: 12px;
        margin-top: 20px;
      }

      .loading.active {
        display: flex;
      }

      .spinner {
        width: 24px;
        height: 24px;
        border: 3px solid var(--border-color);
        border-top-color: var(--accent-purple);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: var(--text-secondary);
        font-size: 0.95rem;
      }

      /* Results Container */
      .results {
        display: none;
      }

      .results.active {
        display: block;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 25px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        border-color: var(--accent-purple);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-1);
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 15px;
      }

      .stat-icon.purple {
        background: rgba(147, 51, 234, 0.1);
        color: var(--accent-purple);
      }
      .stat-icon.pink {
        background: rgba(236, 72, 153, 0.1);
        color: var(--accent-pink);
      }
      .stat-icon.cyan {
        background: rgba(6, 182, 212, 0.1);
        color: var(--accent-cyan);
      }
      .stat-icon.green {
        background: rgba(16, 185, 129, 0.1);
        color: var(--accent-green);
      }
      .stat-icon.orange {
        background: rgba(245, 158, 11, 0.1);
        color: var(--accent-orange);
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 5px;
      }

      .stat-subtitle {
        color: var(--text-muted);
        font-size: 0.85rem;
      }

      /* Score Circle */
      .score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: conic-gradient(
          var(--accent-purple) 0deg,
          var(--accent-pink) 180deg,
          var(--accent-cyan) 360deg
        );
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        margin: 0 auto 15px;
      }

      .score-circle::before {
        content: "";
        position: absolute;
        inset: 5px;
        background: var(--card-bg);
        border-radius: 50%;
      }

      .score-value {
        position: relative;
        z-index: 1;
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--gradient-1);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 5px;
      }

      .tab {
        padding: 12px 24px;
        background: transparent;
        border: none;
        color: var(--text-secondary);
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        border-radius: 8px 8px 0 0;
        transition: all 0.3s ease;
        position: relative;
      }

      .tab:hover {
        color: var(--text-primary);
        background: rgba(147, 51, 234, 0.1);
      }

      .tab.active {
        color: var(--accent-purple);
        background: rgba(147, 51, 234, 0.1);
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: -7px;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-1);
      }

      .tab-badge {
        display: inline-block;
        padding: 2px 8px;
        background: var(--accent-purple);
        color: white;
        border-radius: 10px;
        font-size: 0.7rem;
        margin-left: 8px;
      }

      /* Tab Content */
      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Section Card */
      .section-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 25px;
        box-shadow: var(--shadow-sm);
      }

      .section-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border-color);
      }

      .section-icon {
        width: 45px;
        height: 45px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
      }

      .section-title {
        flex: 1;
      }

      .section-title h3 {
        font-size: 1.4rem;
        margin-bottom: 5px;
      }

      .section-title p {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* Badge */
      .badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge-success {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success);
      }
      .badge-warning {
        background: rgba(234, 179, 8, 0.1);
        color: var(--warning);
      }
      .badge-danger {
        background: rgba(220, 38, 38, 0.1);
        color: var(--danger);
      }
      .badge-info {
        background: rgba(6, 182, 212, 0.1);
        color: var(--accent-cyan);
      }
      .badge-purple {
        background: rgba(147, 51, 234, 0.1);
        color: var(--accent-purple);
      }

      /* Info Grid */
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: var(--secondary-dark);
        border-radius: 10px;
        border-left: 3px solid var(--accent-purple);
      }

      .info-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 500;
      }

      .info-value {
        color: var(--text-primary);
        font-weight: 600;
        font-family: "Fira Code", monospace;
        text-align: right;
      }

      /* List Group */
      .list-group {
        list-style: none;
      }

      .list-item {
        padding: 15px;
        background: var(--secondary-dark);
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s ease;
      }

      .list-item:hover {
        background: var(--border-color);
        transform: translateX(5px);
      }

      .list-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .list-content {
        flex: 1;
      }

      .list-title {
        font-weight: 600;
        margin-bottom: 3px;
      }

      .list-subtitle {
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      /* Progress Bar */
      .progress-bar {
        height: 8px;
        background: var(--secondary-dark);
        border-radius: 10px;
        overflow: hidden;
        margin-top: 10px;
      }

      .progress-fill {
        height: 100%;
        background: var(--gradient-1);
        border-radius: 10px;
        transition: width 1s ease;
      }

      /* Alert */
      .alert {
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: flex;
        align-items: flex-start;
        gap: 15px;
      }

      .alert-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .alert-content {
        flex: 1;
      }

      .alert-title {
        font-weight: 600;
        margin-bottom: 5px;
      }

      .alert-success {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: var(--success);
      }

      .alert-warning {
        background: rgba(234, 179, 8, 0.1);
        border: 1px solid rgba(234, 179, 8, 0.3);
        color: var(--warning);
      }

      .alert-danger {
        background: rgba(220, 38, 38, 0.1);
        border: 1px solid rgba(220, 38, 38, 0.3);
        color: var(--danger);
      }

      .alert-info {
        background: rgba(6, 182, 212, 0.1);
        border: 1px solid rgba(6, 182, 212, 0.3);
        color: var(--accent-cyan);
      }

      /* Table */
      .table-container {
        overflow-x: auto;
        border-radius: 12px;
        background: var(--secondary-dark);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background: var(--card-bg);
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
      }

      td {
        color: var(--text-primary);
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
      }

      tr:last-child td {
        border-bottom: none;
      }

      /* Code Block */
      .code-block {
        background: var(--secondary-dark);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 20px;
        margin: 15px 0;
        overflow-x: auto;
      }

      .code-block code {
        color: var(--accent-cyan);
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
        line-height: 1.8;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
      }

      .empty-icon {
        font-size: 80px;
        margin-bottom: 20px;
        opacity: 0.3;
      }

      .empty-title {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      .empty-subtitle {
        color: var(--text-secondary);
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-muted);
        font-size: 0.9rem;
        border-top: 1px solid var(--border-color);
        margin-top: 60px;
      }

      .footer a {
        color: var(--accent-purple);
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .footer a:hover {
        color: var(--accent-pink);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .logo-text h1 {
          font-size: 2rem;
        }

        .input-group {
          flex-direction: column;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }

        .tabs {
          overflow-x: auto;
          flex-wrap: nowrap;
        }
      }

      /* Utilities */
      .mt-1 {
        margin-top: 10px;
      }
      .mt-2 {
        margin-top: 20px;
      }
      .mt-3 {
        margin-top: 30px;
      }
      .mb-1 {
        margin-bottom: 10px;
      }
      .mb-2 {
        margin-bottom: 20px;
      }
      .mb-3 {
        margin-bottom: 30px;
      }
      .text-center {
        text-align: center;
      }
      .text-muted {
        color: var(--text-muted);
      }
      .font-mono {
        font-family: "Fira Code", monospace;
      }

      /* Reasoning Button Hover Effects */
      .btn-reasoning:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(147, 51, 234, 0.4) !important;
      }

      .btn-reasoning:active {
        transform: translateY(0) !important;
      }

      /* Modal Animation */
      #reasoningModal {
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-animation"></div>

    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <div class="logo-icon">üîç</div>
          <div class="logo-text">
            <h1>Site Index</h1>
            <p>Security Scanner</p>
          </div>
        </div>
        <p class="subtitle">
          Advanced reconnaissance and vulnerability assessment platform for
          ethical hackers and security professionals.
        </p>
      </header>

      <!-- Scan Box -->
      <div class="scan-box">
        <div class="input-group">
          <div class="input-wrapper">
            <span class="input-icon">üåê</span>
            <input type="text" id="domainInput" placeholder="example.com" />
          </div>
          <button class="btn btn-primary" id="scanBtn" onclick="startScan()">
            <span class="btn-icon">
              <span>‚ö°</span>
              <span>Initiate Scan</span>
            </span>
          </button>
        </div>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <span class="loading-text" id="loadingText"
            >Initializing security scan...</span
          >
        </div>
      </div>

      <!-- Results Container -->
      <div class="results" id="results">
        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid"></div>

        <!-- Tabs -->
        <div class="tabs" id="tabs"></div>

        <!-- Tab Content -->
        <div id="tabContent"></div>
      </div>

      <!-- Footer -->
      <footer class="footer">
        <p>
          Site Index v2.0.0 | Built for Tech Community with ‚ù§Ô∏è | ¬© 2025 |
          <a href="/enscan/docs">Documentation</a>
        </p>
      </footer>

      <script>
        let scanData = null;
        let activeTab = "overview";

        // Gemini API Configuration
        const GEMINI_API_KEY = "AIzaSyCMwpK-6Dr9X_MpcCyRR1PJcixg4pW55e8";
        const GEMINI_API_URL =
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent";
        let reasoningCache = {};

        // Start Scan
        async function startScan() {
          const domain = document.getElementById("domainInput").value.trim();

          if (!domain) {
            showNotification("Please enter a domain", "warning");
            return;
          }

          // Reset UI
          document.getElementById("results").classList.remove("active");
          document.getElementById("loading").classList.add("active");
          document.getElementById("scanBtn").disabled = true;

          // Loading messages
          const loadingMessages = [
            "Initializing security scan...",
            "Performing DNS reconnaissance...",
            "Analyzing SSL/TLS configuration...",
            "Checking security headers...",
            "Scanning email security...",
            "Detecting vulnerabilities...",
            "Generating comprehensive report...",
          ];

          let messageIndex = 0;
          const loadingInterval = setInterval(() => {
            document.getElementById("loadingText").textContent =
              loadingMessages[messageIndex];
            messageIndex = (messageIndex + 1) % loadingMessages.length;
          }, 2000);

          try {
            const response = await fetch("/enscan/api/scan", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ domain: domain }),
            });

            const data = await response.json();

            clearInterval(loadingInterval);
            document.getElementById("loading").classList.remove("active");
            document.getElementById("scanBtn").disabled = false;

            if (data.success) {
              scanData = data;
              renderResults(data);
              document.getElementById("results").classList.add("active");
              showNotification("Scan completed successfully!", "success");
            } else {
              showNotification(data.error || "Scan failed", "danger");
            }
          } catch (error) {
            clearInterval(loadingInterval);
            document.getElementById("loading").classList.remove("active");
            document.getElementById("scanBtn").disabled = false;
            showNotification("Network error: " + error.message, "danger");
          }
        }

        // Render Results
        function renderResults(data) {
          renderStatsGrid(data);
          renderTabs();
          renderTabContent(data);
        }

        // Render Stats Grid
        // Render Stats Grid
        function renderStatsGrid(data) {
          const statsGrid = document.getElementById("statsGrid");

          const overallScore = data.overall_score || 0;
          const sslScore = data.ssl?.ssl_score || 0;
          const headerScore = data.security_headers?.score || 0;
          const emailScore = data.email_security?.score || 0;
          const riskLevel = data.risk_assessment?.overall_risk || "UNKNOWN";

          const stats = [
            {
              icon: "üéØ",
              iconClass: "purple",
              label: "Overall Score",
              value: `${overallScore}/10`,
              subtitle: getScoreGrade(overallScore),
              category: "overall",
            },
            {
              icon: "üîí",
              iconClass: "cyan",
              label: "SSL/TLS Score",
              value: `${sslScore}/10`,
              subtitle: data.ssl?.valid ? "Valid Certificate" : "Invalid",
              category: "ssl",
            },
            {
              icon: "üõ°Ô∏è",
              iconClass: "pink",
              label: "Security Headers",
              value: data.security_headers?.grade || "N/A",
              subtitle: `${headerScore}/10 Score`,
              category: "headers",
            },
            {
              icon: "üìß",
              iconClass: "green",
              label: "Email Security",
              value: `${emailScore}/10`,
              subtitle: data.email_security?.risk_level || "N/A",
              category: "email",
            },
            {
              icon: "‚ö†Ô∏è",
              iconClass: "orange",
              label: "Risk Level",
              value: riskLevel,
              subtitle: `${
                data.risk_assessment?.total_issues || 0
              } Issues Found`,
              category: "risk",
            },
          ];

          statsGrid.innerHTML = stats
            .map(
              (stat) => `
                <div class="stat-card" style="position: relative;">
                    <div class="stat-icon ${stat.iconClass}">${stat.icon}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-subtitle">${stat.subtitle}</div>
                    <button onclick="showReasoning('${stat.category}', scanData)"
                            class="btn-reasoning"
                            style="margin-top: 15px; padding: 8px 16px; background: var(--gradient-1); border: none; border-radius: 8px; color: white; font-size: 0.85rem; cursor: pointer; width: 100%; transition: all 0.3s ease; font-weight: 600;">
                        ü§ñ View AI Analysis
                    </button>
                </div>
            `
            )
            .join("");

          // Add hover effect
          document.querySelectorAll(".btn-reasoning").forEach((btn) => {
            btn.addEventListener("mouseenter", (e) => {
              e.target.style.transform = "translateY(-2px)";
              e.target.style.boxShadow = "0 4px 12px rgba(147, 51, 234, 0.4)";
            });
            btn.addEventListener("mouseleave", (e) => {
              e.target.style.transform = "translateY(0)";
              e.target.style.boxShadow = "none";
            });
          });
        }

        // Generate Reasoning with Gemini API
        async function generateReasoning(category, data) {
          // Check cache first
          const cacheKey = `${category}_${data.domain}`;
          if (reasoningCache[cacheKey]) {
            return reasoningCache[cacheKey];
          }

          let prompt = "";

          switch (category) {
            case "overall":
              prompt = `Analyze this security scan and provide detailed reasoning for the overall score of ${
                data.overall_score
              }/10.
                    Include:
                    - Why this score was given
                    - Main security strengths
                    - Critical weaknesses
                    - Specific recommendations

                    Data: SSL Score: ${
                      data.ssl?.ssl_score || 0
                    }/10, Security Headers: ${
                data.security_headers?.grade || "N/A"
              } (${data.security_headers?.score || 0}/10), Email Security: ${
                data.email_security?.score || 0
              }/10, Open Ports: ${data.ports?.total_open || 0}, Risk Level: ${
                data.risk_assessment?.overall_risk || "UNKNOWN"
              }`;
              break;

            case "ssl":
              const sslData = data.ssl || {};
              prompt = `Explain the SSL/TLS score of ${
                sslData.ssl_score || 0
              }/10 for this domain.
                    Details: Valid: ${sslData.valid || false}, Protocol: ${
                sslData.protocol_version || "Unknown"
              }, Cipher: ${
                sslData.cipher_suite?.name || "Unknown"
              }, Days Remaining: ${sslData.days_remaining || "N/A"}
                    Provide reasoning about security implications and recommendations.`;
              break;

            case "headers":
              const headersData = data.security_headers || {};
              prompt = `Explain the Security Headers grade "${
                headersData.grade || "N/A"
              }" and score ${headersData.score || 0}/10.
                    Missing Critical: ${
                      headersData.missing_critical?.join(", ") || "None"
                    }
                    Missing Important: ${
                      headersData.missing_important?.join(", ") || "None"
                    }
                    Explain why this grade was given and what needs improvement.`;
              break;

            case "email":
              const emailData = data.email_security || {};
              prompt = `Explain the Email Security score of ${
                emailData.score || 0
              }/10 and ${emailData.risk_level || "UNKNOWN"} risk level.
                    SPF: ${
                      emailData.spf?.configured
                        ? "Configured"
                        : "Not Configured"
                    }
                    DMARC: ${
                      emailData.dmarc?.configured
                        ? "Configured"
                        : "Not Configured"
                    } (Policy: ${emailData.dmarc?.policy || "N/A"})
                    DKIM: ${
                      emailData.dkim?.configured
                        ? "Configured"
                        : "Not Configured"
                    }
                    Explain the security implications and recommendations.`;
              break;

            case "ports":
              const portsData = data.ports || {};
              prompt = `Analyze the open ports scan results with ${
                portsData.total_open || 0
              } open ports and ${portsData.risk_level || "UNKNOWN"} risk level.
                    High Risk Ports: ${portsData.high_risk_ports || 0}
                    Medium Risk Ports: ${portsData.medium_risk_ports || 0}
                    Explain the security implications and which ports should be closed.`;
              break;

            case "risk":
              const riskData = data.risk_assessment || {};
              prompt = `Analyze the overall risk assessment showing ${
                riskData.overall_risk || "UNKNOWN"
              } risk with ${riskData.total_issues || 0} issues.
                    Critical Issues: ${riskData.critical_issues?.length || 0}
                    High Issues: ${riskData.high_issues?.length || 0}
                    Provide a comprehensive security analysis and prioritized action plan.`;
              break;

            default:
              return "Reasoning not available for this category.";
          }

          try {
            const response = await fetch(
              `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  contents: [
                    {
                      parts: [
                        {
                          text:
                            prompt +
                            "\n\nProvide a clear, professional analysis in 3-4 paragraphs. Focus on actionable insights and security implications.",
                        },
                      ],
                    },
                  ],
                  generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 800,
                  },
                }),
              }
            );

            if (!response.ok) {
              throw new Error(`API returned status ${response.status}`);
            }

            const result = await response.json();
            const reasoning =
              result.candidates?.[0]?.content?.parts?.[0]?.text ||
              "Unable to generate reasoning.";

            // Cache the result
            reasoningCache[cacheKey] = reasoning;

            return reasoning;
          } catch (error) {
            console.error("AI API Error:", error);
            return (
              "Unable to generate reasoning at this time. Please check your API key and connection. Error: " +
              error.message
            );
          }
        }

        // Show Reasoning Modal
        function showReasoning(category, data) {
          // Create modal if it doesn't exist
          let modal = document.getElementById("reasoningModal");
          if (!modal) {
            modal = document.createElement("div");
            modal.id = "reasoningModal";
            modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: none;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    backdrop-filter: blur(5px);
                `;
            document.body.appendChild(modal);

            // Close on click outside
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.style.display = "none";
              }
            });
          }

          // Show loading state
          modal.innerHTML = `
                <div class="section-card" style="max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
                    <button onclick="document.getElementById('reasoningModal').style.display='none'"
                            style="position: absolute; top: 20px; right: 20px; background: var(--accent-purple); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">
                        ‚úï
                    </button>

                    <div class="section-header">
                        <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                            ü§ñ
                        </div>
                        <div class="section-title">
                            <h3>AI-Powered Security Analysis</h3>
                            <p>Generating detailed reasoning...</p>
                        </div>
                    </div>

                    <div style="text-align: center; padding: 40px;">
                        <div class="spinner"></div>
                        <p class="mt-2" style="color: var(--text-secondary);">Analyzing security data with AI...</p>
                    </div>
                </div>
            `;

          modal.style.display = "flex";

          // Generate reasoning
          generateReasoning(category, data).then((reasoning) => {
            const categoryTitles = {
              overall: "Overall Security Score",
              ssl: "SSL/TLS Security",
              headers: "Security Headers",
              email: "Email Security",
              ports: "Port Security",
              risk: "Risk Assessment",
            };

            modal.innerHTML = `
                    <div class="section-card" style="max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
                        <button onclick="document.getElementById('reasoningModal').style.display='none'"
                                style="position: absolute; top: 20px; right: 20px; background: var(--accent-purple); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">
                            ‚úï
                        </button>

                        <div class="section-header">
                            <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                ü§ñ
                            </div>
                            <div class="section-title">
                                <h3>AI-Powered Analysis: ${categoryTitles[category]}</h3>
                                <p>Detailed reasoning and recommendations</p>
                            </div>
                            <span class="badge badge-purple">AI</span>
                        </div>

                        <div class="alert alert-info" style="margin-bottom: 0;">
                            <div class="alert-icon">üí°</div>
                            <div class="alert-content">
                                <div style="white-space: pre-line; line-height: 1.8;">${reasoning}</div>
                            </div>
                        </div>
                    </div>
                `;
          });
        }

        // Render Tabs
        function renderTabs() {
          const tabs = document.getElementById("tabs");

          const tabList = [
            { id: "overview", label: "Overview", icon: "üìä" },
            { id: "ssl", label: "SSL/TLS", icon: "üîí" },
            { id: "headers", label: "Security Headers", icon: "üõ°Ô∏è" },
            { id: "email", label: "Email Security", icon: "üìß" },
            { id: "dns", label: "DNS Records", icon: "üåê" },
            { id: "ports", label: "Port Scan", icon: "üîå" },
            { id: "whois", label: "WHOIS", icon: "üìù" },
            { id: "risks", label: "Risk Assessment", icon: "‚ö†Ô∏è" },
          ];

          tabs.innerHTML = tabList
            .map(
              (tab) => `
                        <button class="tab ${
                          tab.id === activeTab ? "active" : ""
                        }"
                                onclick="switchTab('${tab.id}')">
                            ${tab.icon} ${tab.label}
                        </button>
                    `
            )
            .join("");
        }

        // Switch Tab
        function switchTab(tabId) {
          activeTab = tabId;
          renderTabs();
          renderTabContent(scanData);
        }
        // Render Tab Content
        function renderTabContent(data) {
          const tabContent = document.getElementById("tabContent");

          let content = "";
          switch (activeTab) {
            case "overview":
              content = renderOverview(data);
              break;
            case "ssl":
              content = renderSSL(data);
              break;

            case "headers":
              content = renderHeaders(data);
              break;
            case "email":
              content = renderEmail(data);
              break;
            case "dns":
              content = renderDNS(data);
              break;
            case "ports":
              content = renderPorts(data);
              break;
            case "whois":
              content = renderWhois(data);
              break;
            case "risks":
              content = renderRisks(data);
              break;
          }

          tabContent.innerHTML = content;

          // Force display
          tabContent.style.display = "block";
        }

        // Add animation
        const content = document.querySelector(".tab-content.active");
        if (content) content.classList.remove("active");
        setTimeout(() => {
          const newContent = document.getElementById("tabContent");
          newContent.classList.add("active");
        }, 10);

        // Render Overview
        function renderOverview(data) {
          const overallScore = data.overall_score || 0;
          const riskLevel = data.risk_assessment?.overall_risk || "UNKNOWN";
          const scanTime = new Date(data.scan_timestamp).toLocaleString();

          return `
                        <div class="tab-content active">
                            <div class="section-card">
                                <div class="section-header">
                                    <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                        üìä
                                    </div>
                                    <div class="section-title">
                                        <h3>Scan Overview</h3>
                                        <p>Comprehensive security assessment results</p>
                                    </div>
                                    <span class="badge badge-${getRiskBadgeClass(
                                      riskLevel
                                    )}">${riskLevel} RISK</span>
                                </div>

                                <div class="text-center mb-3">
                                    <div class="score-circle">
                                        <div class="score-value">${overallScore}</div>
                                    </div>
                                    <h4>${getScoreGrade(
                                      overallScore
                                    )} - ${getScoreDescription(
            overallScore
          )}</h4>
                                </div>

                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Target Domain</span>
                                        <span class="info-value">${
                                          data.domain
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Scan Completed</span>
                                        <span class="info-value">${scanTime}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Scan Duration</span>
                                        <span class="info-value">${
                                          data.scan_duration
                                        }s</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Scanner Version</span>
                                        <span class="info-value">${
                                          data.scanner_version
                                        }</span>
                                    </div>
                                </div>
                            </div>

                            ${renderQuickSummary(data)}
                            ${renderRecommendations(data)}
                            ${renderTechnology(data)}
                        </div>
                    `;
        }

        // Render Quick Summary
        function renderQuickSummary(data) {
          const summaryItems = [
            {
              icon: "üîí",
              title: "SSL/TLS Certificate",
              status: data.ssl?.valid ? "Valid" : "Invalid",
              statusClass: data.ssl?.valid ? "success" : "danger",
              details: data.ssl?.valid
                ? `${data.ssl.days_remaining} days remaining`
                : "Certificate issue detected",
            },
            {
              icon: "üõ°Ô∏è",
              title: "Security Headers",
              status: data.security_headers?.grade || "N/A",
              statusClass: getGradeBadgeClass(data.security_headers?.grade),
              details: `${data.security_headers?.score || 0}/10 score`,
            },
            {
              icon: "üìß",
              title: "Email Security",
              status: data.email_security?.risk_level || "N/A",
              statusClass: getRiskBadgeClass(data.email_security?.risk_level),
              details: `${data.email_security?.score || 0}/10 score`,
            },
            {
              icon: "üîå",
              title: "Open Ports",
              status: data.ports?.total_open || 0,
              statusClass:
                data.ports?.risk_level === "CRITICAL" ? "danger" : "info",
              details: data.ports?.risk_level || "N/A" + " risk level",
            },
          ];

          return `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                    ‚ö°
                                </div>
                                <div class="section-title">
                                    <h3>Quick Summary</h3>
                                    <p>Key security metrics at a glance</p>
                                </div>
                            </div>

                            <ul class="list-group">
                                ${summaryItems
                                  .map(
                                    (item) => `
                                    <li class="list-item">
                                        <div class="list-icon" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                            ${item.icon}
                                        </div>
                                        <div class="list-content">
                                            <div class="list-title">${item.title}</div>
                                            <div class="list-subtitle">${item.details}</div>
                                        </div>
                                        <span class="badge badge-${item.statusClass}">${item.status}</span>
                                    </li>
                                `
                                  )
                                  .join("")}
                            </ul>
                        </div>
                    `;
        }

        // Render Recommendations
        function renderRecommendations(data) {
          const recommendations = [];

          if (data.ssl && !data.ssl.valid) {
            recommendations.push({
              level: "danger",
              icon: "üî¥",
              title: "Critical: Invalid SSL Certificate",
              description:
                "Your SSL certificate is invalid or expired. This poses a severe security risk.",
            });
          }

          if (data.security_headers?.missing_critical?.length > 0) {
            recommendations.push({
              level: "danger",
              icon: "üî¥",
              title: "Critical Security Headers Missing",
              description: `Missing: ${data.security_headers.missing_critical.join(
                ", "
              )}`,
            });
          }

          if (
            data.email_security?.risk_level === "CRITICAL" ||
            data.email_security?.risk_level === "HIGH"
          ) {
            recommendations.push({
              level: "warning",
              icon: "‚ö†Ô∏è",
              title: "Email Security Needs Attention",
              description:
                data.email_security?.recommendation ||
                "Configure SPF, DKIM, and DMARC records.",
            });
          }

          if (data.ports?.high_risk_ports > 0) {
            recommendations.push({
              level: "warning",
              icon: "‚ö†Ô∏è",
              title: "Dangerous Ports Exposed",
              description: `${data.ports.high_risk_ports} high-risk ports are open. Review and close unnecessary ports.`,
            });
          }

          if (recommendations.length === 0) {
            recommendations.push({
              level: "success",
              icon: "‚úÖ",
              title: "Good Security Posture",
              description:
                "No critical issues detected. Continue monitoring and maintaining security best practices.",
            });
          }

          return `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon pink" style="background: rgba(236, 72, 153, 0.1); color: var(--accent-pink);">
                                    üí°
                                </div>
                                <div class="section-title">
                                    <h3>Recommendations</h3>
                                    <p>Action items to improve security</p>
                                </div>
                            </div>

                            ${recommendations
                              .map(
                                (rec) => `
                                <div class="alert alert-${rec.level}">
                                    <div class="alert-icon">${rec.icon}</div>
                                    <div class="alert-content">
                                        <div class="alert-title">${rec.title}</div>
                                        <div>${rec.description}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `;
        }

        // Render SSL
        // Render SSL
        function renderSSL(data) {
          if (!data.ssl || !data.ssl.success) {
            return renderError("SSL/TLS data unavailable", data.ssl?.error);
          }

          const ssl = data.ssl;

          return `
                <div class="tab-content active">
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                üîí
                            </div>
                            <div class="section-title">
                                <h3>SSL/TLS Certificate</h3>
                                <p>Certificate and encryption details</p>
                            </div>
                            <span class="badge badge-${
                              ssl.valid ? "success" : "danger"
                            }">
                                ${ssl.valid ? "VALID" : "INVALID"}
                            </span>
                        </div>

                        <button onclick="showReasoning('ssl', scanData)"
                                class="btn btn-primary"
                                style="margin-bottom: 20px; width: 100%;">
                            <span class="btn-icon">
                                <span>ü§ñ</span>
                                <span>Get AI Analysis</span>
                            </span>
                        </button>

                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Common Name</span>
                                <span class="info-value">${
                                  ssl.common_name || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Issuer</span>
                                <span class="info-value">${
                                  ssl.organization || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Valid From</span>
                                <span class="info-value">${
                                  ssl.valid_from || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Valid Until</span>
                                <span class="info-value">${
                                  ssl.valid_until || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Days Remaining</span>
                                <span class="info-value ${
                                  ssl.days_remaining < 30 ? "text-danger" : ""
                                }">${ssl.days_remaining}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Protocol</span>
                                <span class="info-value">${
                                  ssl.protocol_version || "N/A"
                                }</span>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                üîê
                            </div>
                            <div class="section-title">
                                <h3>Cipher Suite</h3>
                                <p>Encryption configuration</p>
                            </div>
                        </div>

                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Cipher Name</span>
                                <span class="info-value">${
                                  ssl.cipher_suite?.name || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Cipher Protocol</span>
                                <span class="info-value">${
                                  ssl.cipher_suite?.protocol || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Cipher Strength</span>
                                <span class="info-value">${
                                  ssl.cipher_suite?.bits || 0
                                } bits</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Public Key Bits</span>
                                <span class="info-value">${
                                  ssl.public_key_bits || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Signature Algorithm</span>
                                <span class="info-value">${
                                  ssl.signature_algorithm || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Self-Signed</span>
                                <span class="info-value">${
                                  ssl.self_signed ? "Yes" : "No"
                                }</span>
                            </div>
                        </div>
                    </div>

                    ${
                      ssl.vulnerabilities && ssl.vulnerabilities.length > 0
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon orange" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                                    ‚ö†Ô∏è
                                </div>
                                <div class="section-title">
                                    <h3>Vulnerabilities Detected</h3>
                                    <p>${
                                      ssl.vulnerabilities.length
                                    } issue(s) found</p>
                                </div>
                            </div>

                            ${ssl.vulnerabilities
                              .map(
                                (vuln) => `
                                <div class="alert alert-warning">
                                    <div class="alert-icon">‚ö†Ô∏è</div>
                                    <div class="alert-content">
                                        <div>${vuln}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }

                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon green" style="background: rgba(16, 185, 129, 0.1); color: var(--accent-green);">
                                üîë
                            </div>
                            <div class="section-title">
                                <h3>Certificate Fingerprints</h3>
                                <p>Hash values for verification</p>
                            </div>
                        </div>

                        <div class="code-block">
                            <code>
                                <strong>SHA-256:</strong><br>${
                                  ssl.fingerprint_sha256 || "N/A"
                                }<br><br>
                                <strong>SHA-1:</strong><br>${
                                  ssl.fingerprint_sha1 || "N/A"
                                }<br><br>
                                <strong>MD5:</strong><br>${
                                  ssl.fingerprint_md5 || "N/A"
                                }
                            </code>
                        </div>
                    </div>

                    ${
                      ssl.san && ssl.san.length > 0
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon pink" style="background: rgba(236, 72, 153, 0.1); color: var(--accent-pink);">
                                    üìã
                                </div>
                                <div class="section-title">
                                    <h3>Subject Alternative Names</h3>
                                    <p>${ssl.san_count} domain(s) covered</p>
                                </div>
                            </div>

                            <ul class="list-group">
                                ${ssl.san
                                  .map(
                                    (san) => `
                                    <li class="list-item">
                                        <div class="list-icon" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                            üåê
                                        </div>
                                        <div class="list-content">
                                            <div class="list-title">${san[1]}</div>
                                            <div class="list-subtitle">${san[0]}</div>
                                        </div>
                                    </li>
                                `
                                  )
                                  .join("")}
                            </ul>
                        </div>
                    `
                        : ""
                    }
                </div>
            `;
        }

        // Render Security Headers
        function renderHeaders(data) {
          if (!data.security_headers || !data.security_headers.success) {
            return renderError(
              "Security headers data unavailable",
              data.security_headers?.error
            );
          }

          const headers = data.security_headers;

          return `
                <div class="tab-content active">
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                üõ°Ô∏è
                            </div>
                            <div class="section-title">
                                <h3>Security Headers Assessment</h3>
                                <p>${
                                  headers.grade_reasoning ||
                                  "Header security analysis"
                                }</p>
                            </div>
                            <span class="badge badge-${getGradeBadgeClass(
                              headers.grade
                            )}">${headers.grade}</span>
                        </div>

                        <button onclick="showReasoning('headers', scanData)"
                                class="btn btn-primary"
                                style="margin: 20px 0; width: 100%;">
                            <span class="btn-icon">
                                <span>ü§ñ</span>
                                <span>Get AI Analysis</span>
                            </span>
                        </button>

                        <div class="text-center mb-3">
                            <div class="score-circle">
                                <div class="score-value">${headers.score}</div>
                            </div>
                            <h4>Security Score: ${headers.score}/${
            headers.max_score
          }</h4>
                        </div>

                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Final URL</span>
                                <span class="info-value" style="word-break: break-all; font-size: 0.8rem;">${
                                  headers.final_url || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Status Code</span>
                                <span class="info-value">${
                                  headers.status_code || "N/A"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">HTTPS Enabled</span>
                                <span class="info-value">${
                                  headers.https_enabled ? "Yes" : "No"
                                }</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Response Time</span>
                                <span class="info-value">${
                                  headers.response_time || 0
                                }s</span>
                            </div>
                        </div>
                    </div>

                    ${renderHeadersTable(headers.headers)}

                    ${
                      headers.info_disclosure &&
                      headers.info_disclosure.length > 0
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon orange" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                                    ‚ö†Ô∏è
                                </div>
                                <div class="section-title">
                                    <h3>Information Disclosure</h3>
                                    <p>${
                                      headers.info_disclosure.length
                                    } potential disclosure(s)</p>
                                </div>
                            </div>

                            ${headers.info_disclosure
                              .map(
                                (disclosure) => `
                                <div class="alert alert-warning">
                                    <div class="alert-icon">‚ÑπÔ∏è</div>
                                    <div class="alert-content">
                                        <div>${disclosure}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }

                    ${
                      headers.cookies
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                    üç™
                                </div>
                                <div class="section-title">
                                    <h3>Cookie Security</h3>
                                    <p>${
                                      headers.cookies.total
                                    } cookie(s) analyzed</p>
                                </div>
                                <span class="badge badge-info">${
                                  headers.cookies.security_score
                                }/10</span>
                            </div>

                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Total Cookies</span>
                                    <span class="info-value">${
                                      headers.cookies.total
                                    }</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Secure Flag</span>
                                    <span class="info-value">${
                                      headers.cookies.secure
                                    }</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">HttpOnly Flag</span>
                                    <span class="info-value">${
                                      headers.cookies.httponly
                                    }</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">SameSite Attribute</span>
                                    <span class="info-value">${
                                      headers.cookies.samesite
                                    }</span>
                                </div>
                            </div>

                            ${
                              headers.cookies.insecure_cookies &&
                              headers.cookies.insecure_cookies.length > 0
                                ? `
                                <div class="mt-2">
                                    <strong class="text-muted">Insecure Cookies:</strong>
                                    <div class="code-block">
                                        <code>${headers.cookies.insecure_cookies.join(
                                          ", "
                                        )}</code>
                                    </div>
                                </div>
                            `
                                : ""
                            }
                        </div>
                    `
                        : ""
                    }
                </div>
            `;
        }

        // Render Headers Table
        function renderHeadersTable(headers) {
          if (!headers) return "";

          const criticalHeaders = [];
          const importantHeaders = [];
          const otherHeaders = [];

          Object.entries(headers).forEach(([name, data]) => {
            const item = { name, ...data };
            if (data.category === "critical") criticalHeaders.push(item);
            else if (data.category === "important") importantHeaders.push(item);
            else otherHeaders.push(item);
          });

          const renderHeaderSection = (title, items, iconClass, icon) => {
            if (items.length === 0) return "";

            return `
                            <div class="section-card">
                                <div class="section-header">
                                    <div class="section-icon ${iconClass}" style="background: rgba(147, 51, 234, 0.1);">
                                        ${icon}
                                    </div>
                                    <div class="section-title">
                                        <h3>${title}</h3>
                                        <p>${items.length} header(s)</p>
                                    </div>
                                </div>
                                <button onclick="showReasoning('headers', scanData)"
                class="btn btn-primary"
                style="margin-bottom: 20px 0; width: 100%;">
            <span class="btn-icon">
                <span>ü§ñ</span>
                <span>Get AI Analysis</span>
            </span>
        </button>

                                <ul class="list-group">
                                    ${items
                                      .map(
                                        (item) => `
                                        <li class="list-item">
                                            <div class="list-icon ${
                                              item.present ? "green" : "orange"
                                            }" style="background: ${
                                          item.present
                                            ? "rgba(16, 185, 129, 0.1)"
                                            : "rgba(245, 158, 11, 0.1)"
                                        }; color: ${
                                          item.present
                                            ? "var(--accent-green)"
                                            : "var(--accent-orange)"
                                        };">
                                                ${item.present ? "‚úì" : "‚úó"}
                                            </div>
                                            <div class="list-content">
                                                <div class="list-title">${
                                                  item.name
                                                }</div>
                                                <div class="list-subtitle">${
                                                  item.description
                                                }</div>
                                                ${
                                                  item.present
                                                    ? `
                                                    <div class="code-block mt-1">
                                                        <code>${item.value}</code>
                                                    </div>
                                                `
                                                    : `
                                                    <div class="mt-1 text-muted">
                                                        <small>üí° ${item.recommendation}</small>
                                                    </div>
                                                `
                                                }
                                            </div>
                                            <span class="badge badge-${
                                              item.present
                                                ? "success"
                                                : "warning"
                                            }">
                                                ${
                                                  item.present
                                                    ? "SET"
                                                    : "MISSING"
                                                }
                                            </span>
                                        </li>
                                    `
                                      )
                                      .join("")}
                                </ul>
                            </div>
                        `;
          };

          return `
                        ${renderHeaderSection(
                          "Critical Headers",
                          criticalHeaders,
                          "purple",
                          "üî¥"
                        )}
                        ${renderHeaderSection(
                          "Important Headers",
                          importantHeaders,
                          "cyan",
                          "üü°"
                        )}
                        ${renderHeaderSection(
                          "Other Headers",
                          otherHeaders,
                          "green",
                          "üü¢"
                        )}
                    `;
        }

        // Render Email Security
        function renderEmail(data) {
          if (!data.email_security || !data.email_security.success) {
            return renderError(
              "Email security data unavailable",
              data.email_security?.error
            );
          }

          const email = data.email_security;

          return `
                        <div class="tab-content active">
                            <div class="section-card">
                                <div class="section-header">
                                    <div class="section-icon pink" style="background: rgba(236, 72, 153, 0.1); color: var(--accent-pink);">
                                        üìß
                                    </div>
                                    <div class="section-title">
                                        <h3>Email Security Assessment</h3>
                                        <p>SPF, DKIM, and DMARC configuration</p>
                                    </div>
                                    <span class="badge badge-${getRiskBadgeClass(
                                      email.risk_level
                                    )}">${email.risk_level}</span>
                                </div>
                                <button onclick="showReasoning('email', scanData)"
                class="btn btn-primary"
                style="margin-bottom: 20px; width: 100%;">
            <span class="btn-icon">
                <span>ü§ñ</span>
                <span>Get AI Analysis</span>
            </span>
        </button>

                                <div class="text-center mb-3">
                                    <div class="score-circle">
                                        <div class="score-value">${
                                          email.score
                                        }</div>
                                    </div>
                                    <h4>Email Security Score: ${email.score}/${
            email.max_score
          }</h4>
                                </div>

                                <div class="alert alert-info">
                                    <div class="alert-icon">üí°</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Recommendation</div>
                                        <div>${
                                          email.recommendation ||
                                          "No specific recommendations"
                                        }</div>
                                    </div>
                                </div>
                            </div>

                            ${renderSPF(email.spf)}
                            ${renderDMARC(email.dmarc)}
                            ${renderDKIM(email.dkim)}
                            ${renderMX(email.mx)}
                        </div>
                    `;
        }

        // Render SPF
        function renderSPF(spf) {
          if (!spf) return "";

          return `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                    üìã
                                </div>
                                <div class="section-title">
                                    <h3>SPF (Sender Policy Framework)</h3>
                                    <p>Email sender authentication</p>
                                </div>
                                <span class="badge badge-${
                                  spf.configured ? "success" : "danger"
                                }">
                                    ${
                                      spf.configured
                                        ? "CONFIGURED"
                                        : "NOT FOUND"
                                    }
                                </span>
                            </div>

                            ${
                              spf.configured
                                ? `
                                <div class="code-block">
                                    <code>${spf.record}</code>
                                </div>

                                <div class="info-grid mt-2">
                                    <div class="info-item">
                                        <span class="info-label">Mechanism Count</span>
                                        <span class="info-value">${
                                          spf.mechanism_count || 0
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Strict Mode</span>
                                        <span class="info-value">${
                                          spf.strict ? "Yes (-all)" : "No"
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Soft Fail</span>
                                        <span class="info-value">${
                                          spf.softfail ? "Yes (~all)" : "No"
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">All Mechanism</span>
                                        <span class="info-value">${
                                          spf.all_mechanism || "N/A"
                                        }</span>
                                    </div>
                                </div>

                                ${
                                  spf.issues && spf.issues.length > 0
                                    ? `
                                    <div class="mt-2">
                                        ${spf.issues
                                          .map(
                                            (issue) => `
                                            <div class="alert alert-warning">
                                                <div class="alert-icon">‚ö†Ô∏è</div>
                                                <div class="alert-content">
                                                    <div>${issue}</div>
                                                </div>
                                            </div>
                                        `
                                          )
                                          .join("")}
                                    </div>
                                `
                                    : ""
                                }
                            `
                                : `
                                <div class="alert alert-danger">
                                    <div class="alert-icon">üî¥</div>
                                    <div class="alert-content">
                                        <div class="alert-title">SPF Not Configured</div>
                                        <div>No SPF record found. Your domain is vulnerable to email spoofing.</div>
                                    </div>
                                </div>
                            `
                            }
                        </div>
                    `;
        }

        // Render DMARC
        function renderDMARC(dmarc) {
          if (!dmarc) return "";

          return `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                    üõ°Ô∏è
                                </div>
                                <div class="section-title">
                                    <h3>DMARC (Domain-based Message Authentication)</h3>
                                    <p>Email authentication and reporting</p>
                                </div>
                                <span class="badge badge-${
                                  dmarc.configured ? "success" : "danger"
                                }">
                                    ${
                                      dmarc.configured
                                        ? "CONFIGURED"
                                        : "NOT FOUND"
                                    }
                                </span>
                            </div>

                            ${
                              dmarc.configured
                                ? `
                                <div class="code-block">
                                    <code>${dmarc.record}</code>
                                </div>

                                <div class="info-grid mt-2">
                                    <div class="info-item">
                                        <span class="info-label">Policy</span>
                                        <span class="info-value">${
                                          dmarc.policy || "N/A"
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Percentage</span>
                                        <span class="info-value">${
                                          dmarc.percentage || "N/A"
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Aggregate Reports</span>
                                        <span class="info-value">${
                                          dmarc.rua || "Not Set"
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Forensic Reports</span>
                                        <span class="info-value">${
                                          dmarc.ruf || "Not Set"
                                        }</span>
                                    </div>
                                </div>

                                ${
                                  dmarc.issues && dmarc.issues.length > 0
                                    ? `
                                    <div class="mt-2">
                                        ${dmarc.issues
                                          .map(
                                            (issue) => `
                                            <div class="alert alert-warning">
                                                <div class="alert-icon">‚ö†Ô∏è</div>
                                                <div class="alert-content">
                                                    <div>${issue}</div>
                                                </div>
                                            </div>
                                        `
                                          )
                                          .join("")}
                                    </div>
                                `
                                    : ""
                                }
                            `
                                : `
                                <div class="alert alert-danger">
                                    <div class="alert-icon">üî¥</div>
                                    <div class="alert-content">
                                        <div class="alert-title">DMARC Not Configured</div>
                                        <div>No DMARC record found. Email authentication policies are not enforced.</div>
                                    </div>
                                </div>
                            `
                            }
                        </div>
                    `;
        }

        // Render DKIM
        function renderDKIM(dkim) {
          if (!dkim) return "";

          return `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon green" style="background: rgba(16, 185, 129, 0.1); color: var(--accent-green);">
                                    üîë
                                </div>
                                <div class="section-title">
                                    <h3>DKIM (DomainKeys Identified Mail)</h3>
                                    <p>Email signature verification</p>
                                </div>
                                <span class="badge badge-${
                                  dkim.configured ? "success" : "danger"
                                }">
                                    ${
                                      dkim.configured
                                        ? "CONFIGURED"
                                        : "NOT FOUND"
                                    }
                                </span>
                            </div>

                            ${
                              dkim.configured
                                ? `
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Selectors Found</span>
                                        <span class="info-value">${
                                          dkim.selectors_found.length
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Total Checked</span>
                                        <span class="info-value">${
                                          dkim.total_checked
                                        }</span>
                                    </div>
                                </div>

                                <div class="mt-2">
                                    <strong class="text-muted">Found Selectors:</strong>
                                    <ul class="list-group mt-1">
                                        ${dkim.selectors_found
                                          .map(
                                            (selector) => `
                                            <li class="list-item">
                                                <div class="list-icon green" style="background: rgba(16, 185, 129, 0.1); color: var(--accent-green);">
                                                    ‚úì
                                                </div>
                                                <div class="list-content">
                                                    <div class="list-title">${selector}</div>
                                                    ${
                                                      dkim.selector_details &&
                                                      dkim.selector_details[
                                                        selector
                                                      ]
                                                        ? `
                                                        <div class="code-block mt-1">
                                                            <code>${dkim.selector_details[selector]}</code>
                                                        </div>
                                                    `
                                                        : ""
                                                    }
                                                </div>
                                            </li>
                                        `
                                          )
                                          .join("")}
                                    </ul>
                                </div>
                            `
                                : `
                                <div class="alert alert-danger">
                                    <div class="alert-icon">üî¥</div>
                                    <div class="alert-content">
                                        <div class="alert-title">DKIM Not Configured</div>
                                        <div>No DKIM selectors found. Email signatures cannot be verified.</div>
                                    </div>
                                </div>
                            `
                            }
                        </div>
                    `;
        }

        // Render MX
        function renderMX(mx) {
          if (!mx) return "";

          return `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon orange" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                                    üìÆ
                                </div>
                                <div class="section-title">
                                    <h3>MX (Mail Exchange) Records</h3>
                                    <p>Mail server configuration</p>
                                </div>
                                <span class="badge badge-${
                                  mx.configured ? "success" : "danger"
                                }">
                                    ${mx.count} Record(s)
                                </span>
                            </div>

                            ${
                              mx.configured
                                ? `
                                <div class="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Priority</th>
                                                <th>Mail Server</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${mx.records
                                              .map(
                                                (record) => `
                                                <tr>
                                                    <td><span class="badge badge-purple">${record.priority}</span></td>
                                                    <td>${record.host}</td>
                                                </tr>
                                            `
                                              )
                                              .join("")}
                                        </tbody>
                                    </table>
                                </div>
                            `
                                : `
                                <div class="alert alert-warning">
                                    <div class="alert-icon">‚ö†Ô∏è</div>
                                    <div class="alert-content">
                                        <div class="alert-title">No MX Records Found</div>
                                        <div>No mail exchange records configured for this domain.</div>
                                    </div>
                                </div>
                            `
                            }
                        </div>
                    `;
        }

        // Render DNS
        function renderDNS(data) {
          if (!data.dns || !data.dns.success) {
            return renderError("DNS data unavailable", data.dns?.error);
          }

          const dns = data.dns;
          const recordTypes = [
            "A",
            "AAAA",
            "MX",
            "NS",
            "TXT",
            "CNAME",
            "SOA",
            "CAA",
            "SRV",
            "PTR",
          ];

          return `
                        <div class="tab-content active">
                            <div class="section-card">
                                <div class="section-header">
                                    <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                        üåê
                                    </div>
                                    <div class="section-title">
                                        <h3>DNS Records</h3>
                                        <p>${
                                          dns.total_records
                                        } total records found</p>
                                    </div>
                                </div>

                                <div class="stats-grid">
                                    ${recordTypes
                                      .map((type) => {
                                        const records = dns.records[type] || [];
                                        return `
                                            <div class="info-item">
                                                <span class="info-label">${type} Records</span>
                                                <span class="info-value">${records.length}</span>
                                            </div>
                                        `;
                                      })
                                      .join("")}
                                </div>
                            </div>

                            ${recordTypes
                              .map((type) => {
                                const records = dns.records[type] || [];
                                if (records.length === 0) return "";

                                return `
                                    <div class="section-card">
                                        <div class="section-header">
                                            <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                                üìã
                                            </div>
                                            <div class="section-title">
                                                <h3>${type} Records</h3>
                                                <p>${
                                                  records.length
                                                } record(s)</p>
                                            </div>
                                        </div>

                                        <ul class="list-group">
                                            ${records
                                              .map(
                                                (record, index) => `
                                                <li class="list-item">
                                                    <div class="list-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                                        ${index + 1}
                                                    </div>
                                                    <div class="list-content">
                                                        <div class="list-title font-mono">${record}</div>
                                                    </div>
                                                </li>
                                            `
                                              )
                                              .join("")}
                                        </ul>
                                    </div>
                                `;
                              })
                              .join("")}
                        </div>
                    `;
        }

        // Render Ports
        function renderPorts(data) {
          if (!data.ports || !data.ports.success) {
            return renderError("Port scan data unavailable", data.ports?.error);
          }

          const ports = data.ports;

          return `
                        <div class="tab-content active">
                            <div class="section-card">
                                <div class="section-header">
                                    <div class="section-icon orange" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                                        üîå
                                    </div>
                                    <div class="section-title">
                                        <h3>Open Ports Detection</h3>
                                        <p>${
                                          ports.total_open
                                        } open port(s) found</p>
                                    </div>
                                    <span class="badge badge-${getRiskBadgeClass(
                                      ports.risk_level
                                    )}">${ports.risk_level} RISK</span>
                                    </div>
                                    <button onclick="showReasoning('ports', scanData)"
                    class="btn btn-primary"
                    style="margin-bottom: 20px; width: 100%;">
                <span class="btn-icon">
                    <span>ü§ñ</span>
                    <span>Get AI Analysis</span>
                </span>
            </button>

                                    <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Total Open</span>
                                        <span class="info-value">${
                                          ports.total_open
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">High Risk Ports</span>
                                        <span class="info-value">${
                                          ports.high_risk_ports
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Medium Risk Ports</span>
                                        <span class="info-value">${
                                          ports.medium_risk_ports
                                        }</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Risk Level</span>
                                        <span class="info-value">${
                                          ports.risk_level
                                        }</span>
                                    </div>
                                </div>
                            </div>

                            ${
                              ports.open_ports && ports.open_ports.length > 0
                                ? `
                                <div class="section-card">
                                    <div class="section-header">
                                        <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                            üìä
                                        </div>
                                        <div class="section-title">
                                            <h3>Open Ports Details</h3>
                                            <p>Service identification and risk assessment</p>
                                        </div>
                                    </div>

                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Port</th>
                                                    <th>Service</th>
                                                    <th>State</th>
                                                    <th>Risk Level</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${ports.open_ports
                                                  .map(
                                                    (port) => `
                                                    <tr>
                                                        <td><strong>${
                                                          port.port
                                                        }</strong></td>
                                                        <td>${port.service}</td>
                                                        <td><span class="badge badge-success">${
                                                          port.state
                                                        }</span></td>
                                                        <td><span class="badge badge-${
                                                          port.danger_level ===
                                                          "high"
                                                            ? "danger"
                                                            : port.danger_level ===
                                                              "medium"
                                                            ? "warning"
                                                            : "info"
                                                        }">${port.danger_level.toUpperCase()}</span></td>
                                                    </tr>
                                                `
                                                  )
                                                  .join("")}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            `
                                : `
                                <div class="alert alert-success">
                                    <div class="alert-icon">‚úÖ</div>
                                    <div class="alert-content">
                                        <div class="alert-title">No Open Ports Detected</div>
                                        <div>No common ports are open on this domain.</div>
                                    </div>
                                </div>
                            `
                            }

                            ${
                              data.http_methods && data.http_methods.success
                                ? `
                                <div class="section-card">
                                    <div class="section-header">
                                        <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                            üåê
                                        </div>
                                        <div class="section-title">
                                            <h3>HTTP Methods</h3>
                                            <p>Allowed HTTP methods</p>
                                        </div>
                                        <span class="badge badge-${getRiskBadgeClass(
                                          data.http_methods.risk
                                        )}">${
                                    data.http_methods.risk
                                  } RISK</span>
                                    </div>

                                    <div class="info-grid">
                                        <div class="info-item">
                                            <span class="info-label">Allowed Methods</span>
                                            <span class="info-value">${
                                              data.http_methods.allowed
                                            }</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Total Methods</span>
                                            <span class="info-value">${
                                              data.http_methods.total_methods
                                            }</span>
                                        </div>
                                    </div>

                                    ${
                                      data.http_methods.dangerous &&
                                      data.http_methods.dangerous.length > 0
                                        ? `
                                        <div class="mt-2">
                                            <div class="alert alert-danger">
                                                <div class="alert-icon">‚ö†Ô∏è</div>
                                                <div class="alert-content">
                                                    <div class="alert-title">Dangerous Methods Detected</div>
                                                    <div>${data.http_methods.dangerous.join(
                                                      ", "
                                                    )}</div>
                                                </div>
                                            </div>
                                        </div>
                                    `
                                        : ""
                                    }
                                </div>
                            `
                                : ""
                            }
                        </div>
                    `;
        }
        // Render WHOIS
        function renderWhois(data) {
          if (!data.whois || !data.whois.success) {
            return renderError("WHOIS data unavailable", data.whois?.error);
          }

          const whois = data.whois;

          return `
        <div class="tab-content active">
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon green" style="background: rgba(16, 185, 129, 0.1); color: var(--accent-green);">
                        üìù
                    </div>
                    <div class="section-title">
                        <h3>WHOIS Information</h3>
                        <p>Domain registration details</p>
                    </div>
                </div>

                <div class="info-grid">
                    ${
                      whois.registrar
                        ? `
                    <div class="info-item">
                        <span class="info-label">Registrar</span>
                        <span class="info-value">${whois.registrar}</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.creation_date
                        ? `
                    <div class="info-item">
                        <span class="info-label">Creation Date</span>
                        <span class="info-value">${whois.creation_date}</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.expiration_date
                        ? `
                    <div class="info-item">
                        <span class="info-label">Expiration Date</span>
                        <span class="info-value">${whois.expiration_date}</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.updated_date
                        ? `
                    <div class="info-item">
                        <span class="info-label">Updated Date</span>
                        <span class="info-value">${whois.updated_date}</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.age_years
                        ? `
                    <div class="info-item">
                        <span class="info-label">Domain Age</span>
                        <span class="info-value">${whois.age_years} years</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.days_until_expiration
                        ? `
                    <div class="info-item">
                        <span class="info-label">Days Until Expiration</span>
                        <span class="info-value ${
                          whois.days_until_expiration < 30 ? "text-danger" : ""
                        }">${whois.days_until_expiration} days</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.registrant_country
                        ? `
                    <div class="info-item">
                        <span class="info-label">Country</span>
                        <span class="info-value">${whois.registrant_country}</span>
                    </div>
                    `
                        : ""
                    }
                    ${
                      whois.dnssec
                        ? `
                    <div class="info-item">
                        <span class="info-label">DNSSEC</span>
                        <span class="info-value">${whois.dnssec}</span>
                    </div>
                    `
                        : ""
                    }
                </div>
            </div>

            ${
              whois.name_servers && whois.name_servers.length > 0
                ? `
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                        üåê
                    </div>
                    <div class="section-title">
                        <h3>Name Servers</h3>
                        <p>${whois.name_servers.length} server(s)</p>
                    </div>
                </div>

                <ul class="list-group">
                    ${whois.name_servers
                      .map(
                        (ns, index) => `
                        <li class="list-item">
                            <div class="list-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                                ${index + 1}
                            </div>
                            <div class="list-content">
                                <div class="list-title font-mono">${ns}</div>
                            </div>
                        </li>
                    `
                      )
                      .join("")}
                </ul>
            </div>
            `
                : ""
            }

            ${
              whois.status && whois.status.length > 0
                ? `
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon orange" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                        ‚ÑπÔ∏è
                    </div>
                    <div class="section-title">
                        <h3>Domain Status</h3>
                        <p>${whois.status.length} status(es)</p>
                    </div>
                </div>

                <ul class="list-group">
                    ${whois.status
                      .map(
                        (status) => `
                        <li class="list-item">
                            <div class="list-icon green" style="background: rgba(16, 185, 129, 0.1); color: var(--accent-green);">
                                ‚úì
                            </div>
                            <div class="list-content">
                                <div class="list-title font-mono">${status}</div>
                            </div>
                        </li>
                    `
                      )
                      .join("")}
                </ul>
            </div>
            `
                : ""
            }

            ${
              data.geolocation && data.geolocation.success
                ? `
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon pink" style="background: rgba(236, 72, 153, 0.1); color: var(--accent-pink);">
                        üìç
                    </div>
                    <div class="section-title">
                        <h3>Geolocation</h3>
                        <p>Server location information</p>
                    </div>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">IP Address</span>
                        <span class="info-value">${
                          data.geolocation.ip || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Country</span>
                        <span class="info-value">${
                          data.geolocation.country || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">City</span>
                        <span class="info-value">${
                          data.geolocation.city || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Region</span>
                        <span class="info-value">${
                          data.geolocation.region || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ISP</span>
                        <span class="info-value">${
                          data.geolocation.isp || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Organization</span>
                        <span class="info-value">${
                          data.geolocation.org || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Timezone</span>
                        <span class="info-value">${
                          data.geolocation.timezone || "N/A"
                        }</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Coordinates</span>
                        <span class="info-value">${
                          data.geolocation.latitude || "N/A"
                        }, ${data.geolocation.longitude || "N/A"}</span>
                    </div>
                </div>
            </div>
            `
                : ""
            }
        </div>
    `;
        }

        // Render Risks
        function renderRisks(data) {
          if (!data.risk_assessment) {
            return renderError("Risk assessment unavailable");
          }

          const risks = data.risk_assessment;

          return `
                <div class="tab-content active">
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon orange" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                                ‚ö†Ô∏è
                            </div>
                            <div class="section-title">
                                <h3>Risk Assessment</h3>
                                <p>${
                                  risks.total_issues
                                } security issue(s) identified</p>
                            </div>
                            <span class="badge badge-${getRiskBadgeClass(
                              risks.overall_risk
                            )}">${risks.overall_risk}</span>
                        </div>

                        <button onclick="showReasoning('risk', scanData)"
                                class="btn btn-primary"
                                style="margin: 20px 0; width: 100%;">
                            <span class="btn-icon">
                                <span>ü§ñ</span>
                                <span>Get AI Analysis</span>
                            </span>
                        </button>
                    </div>

                    ${
                      risks.critical_issues && risks.critical_issues.length > 0
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon" style="background: rgba(220, 38, 38, 0.1); color: var(--danger);">
                                    üî¥
                                </div>
                                <div class="section-title">
                                    <h3>Critical Issues</h3>
                                    <p>${
                                      risks.critical_issues.length
                                    } critical vulnerability(ies)</p>
                                </div>
                            </div>

                            ${risks.critical_issues
                              .map(
                                (issue) => `
                                <div class="alert alert-danger">
                                    <div class="alert-icon">üö®</div>
                                    <div class="alert-content">
                                        <div>${issue}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }

                    ${
                      risks.high_issues && risks.high_issues.length > 0
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--accent-orange);">
                                    üü†
                                </div>
                                <div class="section-title">
                                    <h3>High Priority Issues</h3>
                                    <p>${
                                      risks.high_issues.length
                                    } high-priority item(s)</p>
                                </div>
                            </div>

                            ${risks.high_issues
                              .map(
                                (issue) => `
                                <div class="alert alert-warning">
                                    <div class="alert-icon">‚ö†Ô∏è</div>
                                    <div class="alert-content">
                                        <div>${issue}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }

                    ${
                      risks.medium_issues && risks.medium_issues.length > 0
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon" style="background: rgba(234, 179, 8, 0.1); color: var(--warning);">
                                    üü°
                                </div>
                                <div class="section-title">
                                    <h3>Medium Priority Issues</h3>
                                    <p>${
                                      risks.medium_issues.length
                                    } medium-priority item(s)</p>
                                </div>
                            </div>

                            ${risks.medium_issues
                              .map(
                                (issue) => `
                                <div class="alert alert-info">
                                    <div class="alert-icon">‚ÑπÔ∏è</div>
                                    <div class="alert-content">
                                        <div>${issue}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }

                    ${
                      risks.total_issues === 0
                        ? `
                        <div class="alert alert-success">
                            <div class="alert-icon">‚úÖ</div>
                            <div class="alert-content">
                                <div class="alert-title">Excellent Security Posture</div>
                                <div>No significant security issues detected. Continue monitoring and maintaining security best practices.</div>
                            </div>
                        </div>
                    `
                        : ""
                    }

                    ${
                      data.subdomain_takeover && data.subdomain_takeover.success
                        ? `
                        <div class="section-card">
                            <div class="section-header">
                                <div class="section-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                    üîç
                                </div>
                                <div class="section-title">
                                    <h3>Subdomain Takeover Check</h3>
                                    <p>Vulnerability assessment</p>
                                </div>
                                <span class="badge badge-${
                                  data.subdomain_takeover.vulnerable
                                    ? "danger"
                                    : "success"
                                }">
                                    ${
                                      data.subdomain_takeover.vulnerable
                                        ? "VULNERABLE"
                                        : "SAFE"
                                    }
                                </span>
                            </div>

                            ${
                              data.subdomain_takeover.vulnerable
                                ? `
                                <div class="alert alert-danger">
                                    <div class="alert-icon">üö®</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Subdomain Takeover Vulnerability</div>
                                        <div>This subdomain may be vulnerable to takeover attacks. Immediate action required!</div>
                                        ${
                                          data.subdomain_takeover.patterns_found
                                            ?.length > 0
                                            ? `
                                            <div class="mt-1">
                                                <strong>Detected Patterns:</strong>
                                                <ul style="margin: 5px 0; padding-left: 20px;">
                                                    ${data.subdomain_takeover.patterns_found
                                                      .map(
                                                        (p) => `<li>${p}</li>`
                                                      )
                                                      .join("")}
                                                </ul>
                                            </div>
                                        `
                                            : ""
                                        }
                                    </div>
                                </div>
                            `
                                : `
                                <div class="alert alert-success">
                                    <div class="alert-icon">‚úÖ</div>
                                    <div class="alert-content">
                                        <div class="alert-title">No Subdomain Takeover Risk</div>
                                        <div>No indicators of subdomain takeover vulnerability detected.</div>
                                    </div>
                                </div>
                            `
                            }
                        </div>
                    `
                        : ""
                    }
                </div>
            `;
        }

        // Render Technology Detection
        function renderTechnology(data) {
          if (
            !data.technology_detection ||
            !data.technology_detection.success
          ) {
            return ""; // Return empty if not available
          }

          const tech = data.technology_detection;
          const technologies = tech.technologies || {};

          const totalDetected = tech.total_detected || 0;
          if (totalDetected === 0) return ""; // Don't show if nothing detected

          return `
                <div class="section-card">
                    <div class="section-header">
                        <div class="section-icon cyan" style="background: rgba(6, 182, 212, 0.1); color: var(--accent-cyan);">
                            üîß
                        </div>
                        <div class="section-title">
                            <h3>Technology Stack</h3>
                            <p>${totalDetected} technolog${
            totalDetected === 1 ? "y" : "ies"
          } detected</p>
                        </div>
                    </div>

                    ${Object.entries(technologies)
                      .map(([category, items]) => {
                        if (!items || items.length === 0) return "";

                        const categoryIcons = {
                          web_server: "üñ•Ô∏è",
                          cms: "üìù",
                          javascript_frameworks: "‚öõÔ∏è",
                          analytics: "üìä",
                          cdn: "üåê",
                          other: "üîß",
                        };

                        const categoryNames = {
                          web_server: "Web Server",
                          cms: "Content Management System",
                          javascript_frameworks: "JavaScript Frameworks",
                          analytics: "Analytics",
                          cdn: "Content Delivery Network",
                          other: "Other Technologies",
                        };

                        return `
                            <div class="mt-2">
                                <strong class="text-muted">${
                                  categoryIcons[category] || "üîß"
                                } ${
                          categoryNames[category] || category
                        }:</strong>
                                <ul class="list-group mt-1">
                                    ${items
                                      .map(
                                        (item) => `
                                        <li class="list-item">
                                            <div class="list-icon purple" style="background: rgba(147, 51, 234, 0.1); color: var(--accent-purple);">
                                                ‚úì
                                            </div>
                                            <div class="list-content">
                                                <div class="list-title">${item}</div>
                                            </div>
                                        </li>
                                    `
                                      )
                                      .join("")}
                                </ul>
                            </div>
                        `;
                      })
                      .join("")}
                </div>
            `;
        }

        // Render Error State
        function renderError(title, message) {
          return `
                        <div class="tab-content active">
                            <div class="empty-state">
                                <div class="empty-icon">‚ö†Ô∏è</div>
                                <div class="empty-title">${title}</div>
                                <div class="empty-subtitle">${
                                  message ||
                                  "Unable to retrieve data for this section"
                                }</div>
                            </div>
                        </div>
                    `;
        }

        // Helper Functions
        function getScoreGrade(score) {
          if (score >= 9) return "Excellent";
          if (score >= 7.5) return "Good";
          if (score >= 5) return "Fair";
          if (score >= 3) return "Poor";
          return "Critical";
        }

        function getScoreDescription(score) {
          if (score >= 9)
            return "Outstanding security posture with comprehensive protections";
          if (score >= 7.5)
            return "Solid security configuration with minor improvements needed";
          if (score >= 5)
            return "Moderate security with several areas requiring attention";
          if (score >= 3)
            return "Weak security posture with significant vulnerabilities";
          return "Critical security failures requiring immediate remediation";
        }

        function getRiskBadgeClass(risk) {
          const riskMap = {
            CRITICAL: "danger",
            HIGH: "warning",
            MEDIUM: "info",
            LOW: "success",
            UNKNOWN: "info",
          };
          return riskMap[risk] || "info";
        }

        function getGradeBadgeClass(grade) {
          if (!grade) return "info";
          if (grade.startsWith("A")) return "success";
          if (grade.startsWith("B")) return "info";
          if (grade.startsWith("C")) return "warning";
          return "danger";
        }

        // Notification System
        function showNotification(message, type = "info") {
          const notification = document.createElement("div");
          notification.className = `alert alert-${type}`;
          notification.style.cssText =
            "position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; animation: slideIn 0.3s ease;";
          notification.innerHTML = `
                        <div class="alert-icon">${getNotificationIcon(
                          type
                        )}</div>
                        <div class="alert-content">
                            <div>${message}</div>
                        </div>
                    `;

          document.body.appendChild(notification);

          setTimeout(() => {
            notification.style.animation = "slideOut 0.3s ease";
            setTimeout(() => notification.remove(), 300);
          }, 3000);
        }

        function getNotificationIcon(type) {
          const icons = {
            success: "‚úÖ",
            danger: "‚ùå",
            warning: "‚ö†Ô∏è",
            info: "‚ÑπÔ∏è",
          };
          return icons[type] || "‚ÑπÔ∏è";
        }

        // Keyboard shortcuts
        document.addEventListener("keydown", (e) => {
          if (
            e.key === "Enter" &&
            document.activeElement.id === "domainInput"
          ) {
            startScan();
          }
        });

        // Animation styles
        const style = document.createElement("style");
        style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(400px);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }

                    @keyframes slideOut {
                        from {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateX(400px);
                            opacity: 0;
                        }
                    }
                `;
        document.head.appendChild(style);

        // Initialize
        console.log(
          "%cüîç Site Index Security Scanner v2.0.0",
          "color: #9333ea; font-size: 16px; font-weight: bold;"
        );
        console.log(
          "%cAdvanced security reconnaissance platform",
          "color: #94a3b8; font-size: 12px;"
        );
      </script>
    </div>
  </body>
</html>
